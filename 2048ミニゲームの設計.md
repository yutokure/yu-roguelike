# 2048ミニゲームの設計

本設計は「ミニゲームAPI書（MiniExp MOD API v0.1）」準拠。開始時に盤面サイズを4x4〜16x16で設定できる2048。合成ごとに対数ベースのEXPを付与し、2048達成でボーナスを与えます。

- ID: `game2048`
- 表示名: 2048
- エントリ: `games/2048.js`
- バージョン: 0.1.0

## ルール/操作
- 矢印キー or スワイプ: 盤面をスライド。隣接かつ同値は1回の移動で1度だけ合成。
- 毎手終了時にランダム位置へ 2（90%）/4（10%）を出現。
- 盤面が埋まり、移動不能でゲームオーバー。

## 設定/難易度
- 設定画面（開始直後のUI）で盤面サイズ `N×N` を選択（4〜16）。
- `difficulty` はスピード/演出のみ（スコアやEXP配分には影響しない）。

## EXP 仕様（必須要件の反映）
- 合成時: `log2(合成後タイルの数値)` を加算（例: 4→2, 8→3, 16→4）。
- 2048達成: 追加で +777 EXP（初回到達時のみ）。
- 付与タイミング: 1手の合成が確定したフレームで合計し `awardXp(sum)`。

## 記録/スコア
- `getScore()` = `maxTile`（盤面で到達した最大タイル）。
- `bestScore` は最大タイルの最大値を採用。

## UI/演出
- 上: 最大タイル/スコア（標準2048準拠）。
- 合成時に合計EXPをポップ表示。2048到達時は専用演出＋「+777 EXP」。

## 実装方針（API連携）
- `create(root, awardXp, { difficulty })`:
  - 最初に設定UI（サイズ選択）を表示、決定で盤面生成。
  - 1手の移動→合成結果から `sumExp = Σ log2(mergedVal)` を算出し `awardXp(sumExp,{type:'merge'})`。
  - 2048達成時はフラグで一度だけ `awardXp(777,{type:'2048'})`。
- 入力はキー/スワイプ両対応（タッチはしきい値/方向抽出）。

## エラー/ガード
- 合成は1列（または1行）内で左から順に1回制約を厳守。
- サイズ拡大時の描画負荷対策（セル幅を算出、キャンバス文字サイズ動的縮小）。

## manifest.json 例
```json
{ "id": "game2048", "name": "2048", "entry": "games/2048.js", "version": "0.1.0", "description": "合成log2 / 2048で+777EXP", "category": "パズル" }
```
