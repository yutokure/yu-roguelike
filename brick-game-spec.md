# Brick Game 内蔵ゲーム 要件定義・仕様書

**版:** v1.0  
**対象:** 代表的な Brick Game（10×20 LCD、A〜Xのゲーム選択、速度/レベル可変）系ファームウェアをベースにした互換実装  
**想定利用:** 仕様共有／実装指針／テスト観点の統一

---

## 0. 目的と範囲
- 90年代以降に流通した「Brick Game」系携帯電子ゲームの**共通仕様**と**主要内蔵ゲーム**の要件を、現代の再実装（エミュレータ/リメイク）向けに標準化する。
- 実機はメーカーやROM差で挙動差がある。本書は**代表的挙動の合意仕様**を定義し、互換性の目安とする。

---

## 1. 共通仕様（ハード/OS/UX前提）
### 1.1 画面と座標
- 表示: **10×20 の単色LCD**を基本グリッドとする（横10, 縦20）。
- 右側インジケータ: Next, Score, Level, Speed, Lines/Lives などの小型表示を配置可能。実装ではHUD領域で代替可。
- FPS/更新: 60Hz（内部タイマで可変）。LCDの点滅表現は**ON/OFFの2値**。

### 1.2 入力デバイス
- 方向: Left / Right / Down / Up（Upは一部未使用）
- アクション: **Rotate/Fire**（ゲームにより回転/発射/決定）
- その他: Start/Pause, Reset, Sound（ON/OFF）, Speed/Level 設定（左右で調整）

### 1.3 共通ゲーム制御
- **Level**: 難易度段階（1..10 目安）で敵AI/出現密度/落下間隔等を定義。
- **Speed**: ゲーム全体のティック間隔に係数として掛ける（例: S1=1.0, S10=0.4）。
- **Variation/Mode**: 同一ゲームの派生ルール。番号で選択（例: A-1, A-2…）。
- **Pause**: Start/Pause でトグル。タイマ停止、入力無効。
- **ミュート**: Sound トグル。ビープ/着信音のみ。

### 1.4 スコアとライフ
- スコア最大値は 999999 までの6桁表示を標準。桁あふれ時は上限保持。
- ライフ/残機の初期値はゲームごとに定義。0でゲームオーバー。

### 1.5 擬似乱数
- 16bit LFSR を標準。Seed は起動時刻/入力イベントXORで初期化。リプレイ用途では固定Seed記録。

### 1.6 サウンド
- 単音ビープ。イベント別に**低/中/高**の3音高と**短/中/長**の3長さを組合せ。

---

## 2. メニューとゲーム選択モデル（例）
- **A〜X のレター**でゲームカテゴリ、**数字**でバリエーション/モードを示す。
- 例（互換マッピングの推奨）
  - **A**: Tanks（戦車）
  - **B**: Brick Breaker（ブロック崩し）
  - **C**: Racing（レース）
  - **D**: Supplement Shooting（ライン埋め型シューティング）
  - **E**: Snake（スネーク）
  - **F**: Frog Across River（川渡り）
  - **G**: Shooting Players（対向シューティング）
  - **H**: Dance（リズム/ダンス）
  - **I〜P**: Brick Puzzle Classic（テトリス系/各90モード想定）
  - **Q〜X**: Brick Puzzle Pentix（ペントミノ系）

> 注: 実機ROMでは構成が異なる場合あり。本書は代表的な構成を採用。

---

## 3. 個別ゲーム仕様

> 各ゲームは **概要 / フィールド / 操作 / ルール / スコア / レベル&スピード / 勝敗条件 / バリエーション / テスト** の順で定義。

### 3.1 Brick Puzzle Classic（テトリス系）
- **概要**: 7種テトロミノを落下回転させ、横一列10セルを消去して得点。
- **フィールド**: 10×20。天井外に1行のスポーン行を持つ。
- **操作**: Left/Right=水平移動, Down=ソフトドロップ, Rotate=回転（右回転）。
- **ルール**:
  - ピースは1セル刻みで移動/回転。衝突時は確定固定。
  - ライン消去: 同時消し 1〜4 （**シングル/ダブル/トリプル/4ライン**）。
  - ホールドなし。ネクスト1個表示。壁蹴りは**無効**（互換重視）。
- **スコア（標準）**: シングル=40, ダブル=100, トリプル=300, 4ライン=1200。ソフトドロップ=1/セル。（上位互換の参考値。実機は実装差あり）
- **レベル&スピード**: レベル上昇で落下間隔短縮。LevelNの落下ティック=base×k(N)。
- **勝敗**: ミノ確定時に**天井超過**でゲームオーバー。
- **バリエーション例**:
  - I系: クラシック回転、初期障害ブロック0/10/20%等。
  - J〜P系: 開始レベル差、ガベージ発生、ミラーモード等。
- **テスト**:
  - 回転不可ケース（壁/床/他ミノ）で位置不変を確認。
  - 同時複数ラインの一括消去と落下が正。
  - 天井越え確定時にGO判定が走る。

### 3.2 Brick Puzzle Pentix（ペントミノ系）
- **概要**: 12種ペントミノ落下。基本は3.1に準拠し難度上昇。
- **差分仕様**: ピース集合変更・回転図形定義のみ差し替え。スコア倍率×1.5推奨。
- **テスト**: 全12種の回転対称/ミラー対称の衝突判定。

### 3.3 Racing（レース）
- **概要**: 1車線〜3車線の縦スクロール道路で障害車を回避し距離/加点を稼ぐ。
- **フィールド**: 横3〜5列の車線を画面中央に縦表示。自車は最下段。
- **操作**: Left/Right=車線変更。Rotate=（派生）ターボ/クラクション無効化など。
- **ルール**:
  - 敵車/障害は上→下へスクロール。自車と衝突でライフ-1。
  - 距離による徐々のスクロール加速。空きマス生成はPRNG。
- **スコア**: 経過フレーム/セル通過で+1、危険回避（至近すり抜け）+5。
- **レベル&スピード**: レベルでスポーン率↑、最低間隔↓。
- **勝敗**: ライフ0でゲームオーバー。一定距離で周回ボーナス+100。
- **バリエーション**: 1車線（Rally狭路）、路肩障害、2連敵車など。
- **テスト**: スクロール速度と入力受付のフレーム同期。連続衝突の多重判定抑止。

### 3.4 Snake（スネーク）
- **概要**: 蛇を操作し餌を取得して長くする。自衝突/壁衝突でミス。
- **フィールド**: 10×20。壁有/無モード。
- **操作**: 方向キーで進行方向変更（**即時**）。
- **ルール**: 餌取得で長さ+1、ランダム再配置（空マスのみ）。
- **スコア**: 餌1つ=+10。連続取得タイムウィンドウ内×コンボ倍率。
- **レベル&スピード**: レベルでティック短縮。最大長は200セル上限。
- **勝敗**: 頭が壁/自身に接触で-1ライフ。ライフ0で終了。
- **バリエーション**: 壁有/無、Poison（毒餌: 長さ-2/スコア+20）。
- **テスト**: 反転禁止（180度ターン直後の自己衝突抑止）。

### 3.5 Frog Across River（川渡り）
- **概要**: 下段から上段へカエルを導き、流れる丸太/車を回避して**上岸ゴール**へ。
- **フィールド**: 下から「道路→川→上岸」。各レーンは左右にオブジェクトが流れる。
- **操作**: 方向で1セル移動。Downは後退可能。
- **ルール**:
  - 道路: 車体との重なりでミス。川: 丸太上のみ安全、丸太に乗ると一緒に流れる。
  - 画面端/水没でミス。上岸の**指定ゴール枠**に入ると1ラウンドクリア。
- **スコア**: 前進+1/歩、ゴール+50、連続ノーミス×1.2。
- **レベル&スピード**: レベルで車/丸太の速度↑、間隔↓。
- **勝敗**: ライフ制。規定数のゴール枠（例: 5）すべて埋めると面クリア。
- **バリエーション**: 夜間（視界狭）、狭ゴール、逆流。
- **テスト**: 丸太上の同時移動同期、端での落下判定の境界条件。

### 3.6 Tanks（戦車）
- **概要**: 自機戦車で敵を撃破。弾は1発ずつ、障害物で弾消滅。
- **フィールド**: 単純な障害ブロック配置。敵スポーンは上段。
- **操作**: 方向=移動、Rotate/Fire=発射。
- **ルール**: 弾は直進。敵弾と相殺可（派生）。自機ヒットでライフ-1。
- **スコア**: 敵撃破+10、連続無被弾ボーナス/面クリア+50。
- **レベル&スピード**: レベルで敵移動/射撃間隔短縮、同時最大数↑。
- **勝敗**: ライフ0で終了。
- **バリエーション**: 固定/破壊可能ブロック、ボス（HP3〜5）等。
- **テスト**: 弾の多重ヒット禁止、敵スポーン安全距離の確保。

### 3.7 Brick Breaker（ブロック崩し）
- **概要**: パドルでボールを反射し、ブロックを消去。
- **フィールド**: 上部ブロック層、下部にパドル、1〜2球。
- **操作**: Left/Right=パドル移動、Rotate=発射/再開。
- **ルール**: 壁/ブロック/パドルで反射。底面落下でライフ-1。
- **スコア**: ブロック1個=+5、列消し/ラストブロック+ボーナス。
- **レベル&スピード**: レベルで初速↑、硬いブロック混入。
- **バリエーション**: 狭パドル、2球同時、貫通球（一定時間）。
- **テスト**: 角度量子化（例: 8方向）で反射安定性を確認。

### 3.8 Supplement Shooting（ライン埋め型シューティング）
- **概要**: 下段から弾を直上に発射し、上層の**欠け行を埋めて**行完成で消去。
- **フィールド**: 上部に穴あき行がランダム生成。弾は1セル弾。
- **操作**: Left/Right=砲台移動、Rotate/Fire=発射。
- **ルール**: 弾が空セルに着弾するとブロック化。行が埋まると消去+加点。
- **スコア**: 行完成=+20、連続完成（同一弾列で2行以上）×倍率。
- **レベル&スピード**: スポーン間隔↓、行の穴数の増加/移動行など。
- **勝敗**: 穴が下段まで到達or上段一杯でライフ-1/ゲームオーバー。
- **テスト**: 埋め込みと消去のアトミシティ（同フレーム内で判定）。

### 3.9 Shooting Players（対向シューティング）
- **概要**: 下段自機 vs 上段敵。敵弾と障害を避けつつ撃破。
- **フィールド**: 10列の空間。敵は横移動/下降のパターン。
- **操作**: Left/Right=移動、Rotate/Fire=射撃、Down=緊急減速等（派生）。
- **ルール**: 自弾1発制限。命中で敵消滅、一定数撃破で面クリア。
- **スコア**: 撃破+10、連続ヒット×倍率、全滅+ボーナス。
- **レベル&スピード**: 敵速度↑、編隊密度↑、弾速↑。
- **勝敗**: 被弾/接触でライフ-1。
- **テスト**: 弾相殺と同フレーム判定の優先順位。

### 3.10 Dance（ダンス/リズム）
- **概要**: 提示矢印シーケンスに合わせて入力。正確さで採点。
- **フィールド**: 上部に矢印キュー、下部に判定ライン。
- **操作**: 方向入力のみ。Rotateは決定/開始。
- **ルール**: Good/Bad/Miss の3判定。長押しは未使用（実機互換）。
- **スコア**: Good=+2, Bad=0, Miss=-1。コンボで+ボーナス。
- **レベル&スピード**: テンポ↑、同時押し有無（派生）。
- **勝敗**: 規定小節終了で集計。ライフ制はオプション。
- **テスト**: 判定ウィンドウ（±フレーム）と入力バッファリング確認。

### 3.11 Pong（ポン） ※実装オプション
- **概要**: 1P対CPUの横Pong。点数先取。
- **フィールド**: 左右にパドル、中央にボール。
- **操作**: Up/Down=パドル移動。Rotate=サーブ。
- **ルール**: 反射角は当たり位置で変化。外周抜けで相手点。
- **スコア**: 先取 5点。
- **バリエーション**: パドル短縮、ボール加速、ブロック障害物。

### 3.12 Quarth（長方形消去） ※実装オプション
- **概要**: 上部からのブロック変形塊を、下段砲台から弾を打ち**長方形**に揃えて消す。
- **差分**: 3.8と同系だが「**矩形認識**」が必要。消去判定は閉領域充填で行う。

---

## 4. 共通テクニカル仕様
### 4.1 タイミングモデル
- メインループ: `Input → Update (N回/秒) → Render`。
- 可変速は**ティック数**を短縮し、移動/落下/スポーンに同一ティックを用いる。

### 4.2 当たり判定
- グリッド単位のAABB（1セル矩形）。弾/ボールは**サブステップ**（2〜4）でトンネリング防止。

### 4.3 データ表現
- 10×20のビットボード（`uint16_t row[20]` など）。
- ピースは回転別のビットマスクテーブル。

### 4.4 セーブ/リプレイ
- ハイスコア/設定（Sound, Level, Speed, Mode）を永続化。
- リプレイは**Seed**と入力列を記録。

---

## 5. QA観点（抜粋）
- **境界**: 画面端/天井/床での回転・移動・反射。
- **同時事象**: 同フレームのライン消去と落下、弾着と相殺、スポーン重複。
- **速度**: S1/S10で操作遅延や入力取りこぼしがない。
- **再現性**: 固定Seedで同一挙動を再現できる。

---

## 6. 用語
- **Pentix**: ペントミノ版テトリス。本書では12種を想定。
- **行完成**: 横10セルが完全に埋まる状態。

---

## 7. 参考（一般情報源）
- Brick Game の代表的なゲーム構成と10×20グリッドの慣習
- 代表的な互換アプリに見られる A〜X の割り当て例（Tanks / Racing / Snake / Frog Across River / Brick Breaker / Brick Puzzle Classic / Pentix 等）
- 実機差異（メーカー/ROM）と“9999 in 1”表記の一般事情

> 本書は上記の一般的知見を踏まえた**統合仕様**です。ROMによっては名称や細部が異なる場合があります。
> これはミニゲー経験でのミニゲームMODです。