# 擬似3Dレースミニゲームの設計

## 目的
- ミニゲームModに、1980年代アーケード風の疑似3Dレース体験を提供する。
- 疾走感のあるコース、追い越しによるスコアリング、難易度ごとのプレイフィールを実現する。

## ゲームタイトル
- 表示名: **ハイウェイチェイサー**
- ID: `pseudo3d_race`

## プレイ概要
- プレイヤーは自車を左右に操作し、交通を避けつつ制限時間内に距離を稼ぐ。
- コースは疑似3D表示で、カーブと起伏、背景のパララックスで演出。
- 残り時間が0になるかクラッシュ回数が上限に達すると終了。

## 操作
- ← → : レーン移動
- ↑ : 加速
- ↓ : 減速
- スペース : ニトロ (クールダウン制)
- P または一時停止ボタン : 一時停止/再開
- R : ゲームオーバー後のリスタート

## メカニクス
- 疑似3Dエンジン: 直線セグメントの連続で構成されたループコースを使用。各セグメントにカーブ量と標高を持たせ、視点投影で描画。
- 車両挙動: 加速・減速は慣性あり、カーブ時には横Gで自動的に外側へ流れる。
- 交通車両: 各セグメントにランダムでスポーンするCPU車。追い越し時にEXPとスコアを獲得。
- ニトロ: 使用時に短時間だけ最高速を上げる。クールダウン中は使用不可。
- タイムゲージ: 距離到達やセクション通過で延長。

## 難易度設定
| 難易度 | 時間 | 最高速 | CPU密度 | クラッシュ許容量 |
|--------|------|--------|---------|-------------------|
| EASY   | 75s  | 260km/h| 低      | 5回               |
| NORMAL | 60s  | 300km/h| 中      | 3回               |
| HARD   | 50s  | 330km/h| 高      | 2回               |

- 難易度に応じてEXP倍率も微調整。

## スコア/EXP
- 距離10mごとに+0.5EXP。
- 追い越し成功で+4EXP。
- セクション突破（一定距離ごと）で+25EXP。
- ゲームオーバーまでクラッシュせずに完走するとボーナス+100EXP。

## UI
- キャンバス上に速度計、タコメーター風バー、残り時間、進行距離、クラッシュ回数を表示。
- 一時停止・リスタートボタンを併設。

## 実装ノート
- `games/pseudo3d_race.js` にゲームロジックと描画を実装し、`window.registerMiniGame`で登録。
- 描画はCanvas 2Dコンテキストを使用し、遠近計算は各セグメントの「投影済み座標」を算出して面描画。
- CPU車との衝突判定は同一セグメント内で横位置の差と距離を元に簡易判定。
- スマホ操作は仮想ボタン (左右/アクセル/ブレーキ/ニトロ) を追加。
- `manifest.json.js` にゲーム情報を追記。

## 期待される拡張
- 背景スプライト（山・建物）の追加。
- ニトロ演出（モーションブラー等）。
- ランキング保存。

