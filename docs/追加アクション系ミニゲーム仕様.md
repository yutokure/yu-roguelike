# 追加アクション系ミニゲーム仕様

本書は Manifest v0.1.0 で新たに追加されたアクション/シューティング系ミニゲームの実装仕様を整理し、EXP付与ルールと難易度差分をまとめたものです。各モジュールはいずれも MiniExp API に従い `create(root, awardXp, { difficulty })` を返却し、Pause/Restart 操作や `window.showTransientPopupAt` を活用します。

## Aim Trainer (`aim`)
- **概要**: キャンバス上に出現する円形ターゲットをマウスクリックで撃ち抜くエイム練習。的はバウンドしながら寿命3〜5秒で消滅。
- **難易度差分**: 的の半径・移動速度・出現頻度・コンボ猶予（EASY 1300ms / NORMAL 1100ms / HARD 900ms）を調整。
- **EXP**: 命中精度で基礎値 1 / 2 / 3。連続命中は 0.25 ずつ倍率加算（例: 3連続で基礎×1.5）。命中位置に `showTransientPopupAt` でコンボ演出。

## 回避レース (`dodge_race`)
- **概要**: 縦スクロールの車線を左右移動して障害物を避ける。スペースでターボ（高速＋高EXP）を発動。
- **難易度差分**: ティック間隔・車線数・障害物生成確率・ターボ倍率・チェックポイント周期を調整。
- **EXP**: ゲーム開始直後は難易度ごとのグレース期間（EASY 0ms / NORMAL 1000ms / HARD 2000ms）で加算停止。通常時は 35% の確率で `tickXp`（EASY 0.12 / NORMAL 0.15 / HARD 0.18）を付与。ターボ中は難易度別 `turboTickXp`（0.5/1/2）を毎ティック固定付与。一定ティックごとにチェックポイントEXP（EASY 5 / NORMAL 7 / HARD 15）を獲得、ターボ時は2倍。チェックポイント位置にはコンボ風ポップを表示。

## 落下ブロック・シューター (`falling_shooter`)
- **概要**: グリッド上に落下するブロックを自機のショットで破壊する。スペース長押しでオート連射（EASYのみ）。
- **難易度差分**: ティック間隔・列幅・ショットクールダウンを調整。HARDは狭いフィールド＋高速ティック。
- **EXP**: ブロックHPに応じて `Math.round(1 + (maxHp-1)*0.6)` を付与。破壊位置にポップ表示。ソフトドロップ等に追加EXPはなし。

## 川渡り (`river_crossing`)
- **概要**: Frogger風に丸太を渡って上段を目指す。上下左右キーで1セル移動。
- **難易度差分**: 行数・列数・丸太の速度・ライフ数を調整。HARDはレーン数増＋高速移動。
- **EXP**: 上方向に1段進むごとに +1 EXP。最上段到達で +50 EXP を即時付与。到達後は初期位置へ戻り周回。

## モグラたたき (`whack_a_mole`)
- **概要**: グリッド内のモグラをクリックで叩く。45秒制限。命中率やコンボをHUD表示。
- **難易度差分**: ポップ時間・モグラ間隔・盤面サイズ・コンボ猶予（EASY 1200ms / NORMAL 1050ms / HARD 900ms）を調整。
- **EXP**: ヒットで基礎1EXP。連続ヒットは 0.25 ずつ加算（5連続で `floor(1 + 0.25*4)=2` EXP）。ミスするとコンボリセット。

## イライラ棒 (`steady_wire`)
- **概要**: ランダム生成された通路をマウスまたはキーボードでなぞりゴールを目指す。途中に進捗バーと操作モード切替。
- **難易度差分**: 通路幅、ランダム揺れ量、キーボード操作速度、チェックポイント/クリアEXP（EASY 4/24、NORMAL 6/36、HARD 9/52）を調整。
- **EXP**: 進捗20%ごとにチェックポイントEXPを支給。ゴール時に finishXp を追加付与。途中で失敗した場合は進捗割合に応じて最大35%のリカバリEXPを与える。

## フラッピーバード風 (`flappy_bird`)
- **概要**: スペース／クリックで羽ばたき、上下のパイプを通過する。通過数とコンボをスコア化。
- **難易度差分**: 重力・上昇速度・パイプ間隔・スクロール速度・発生間隔・通過EXP（6/8/11）・コンボボーナス（1.5/2/2.5）を調整。
- **EXP**: パイプ通過で `passXp + (combo-1)*comboBonus` を付与。墜落時は経過スコア×0.6（最低2）を清算XPとして支給。

## ダイノランナー (`dino_runner`)
- **概要**: Chrome恐竜風ランナー。スペースでジャンプ、矢印下でスライディング。時間経過でスピード上昇。
- **難易度差分**: 初期速度・加速度・重力・ジャンプ力・障害物出現間隔・通過/距離EXP（passXp=4/6/9, distanceXp=60/45/36）を調整。
- **EXP**:
  - 障害物通過で `passXp + (combo-1)*1.8` を加算（最大コンボ5段階演出）。
  - 距離10単位ごとに `distanceXp/10` を小刻みに付与。
  - ゲームオーバー時は走破距離に応じたボーナス `max(2, round(distance / distanceXp))` を支給。

## 1010パズル (`ten_ten`)
- **概要**: 10×10 の盤にブロックを置き、列/行を消していくスコア型パズル。手詰まりで終了。
- **難易度差分**: ピース出現ウェイトを難易度で調整（小型ピース比率や不規則形状のウェイトが変動）。
- **EXP**: ライン消去数に応じたテーブル `{1:2, 2:10, 3:25, 4:50, 5+:150}` を使用。行列同時消去は2倍。消去セル数を `showTransientPopupAt` で表示。複数行列同時消去時は `rows+cols` をコンボレベルとして扱う。

## トリオミノコラムス (`triomino_columns`)
- **概要**: 3セルのトリオミノを落としてライン消去やVSモードを楽しむ大規模モジュール。Endless / CPU対戦 / 2P 対戦を収録。
- **難易度差分**: ゲーム内メニューでモードを選択（難易度はゲーム側で速度やギミックを調整）。
- **EXP**: 行動ごとに細分化。
  - ソフトドロップ: +0.1 EXP
  - 回転成功（CW/CCW）: +0.05 EXP
  - ライン消去: クリアセル数×0.6 EXP
  - 連鎖（Spark/Combo）: `combo * 2` EXP を追加
  - VS勝利: +40 EXP（CPU/2P共通）
  - ホールド/ミスなどはEXP変動なし。勝敗情報は `meta` にモードや勝者名を添付。

---

これらのモジュールは全て `awardXp` の戻り値を利用して HUD 更新と記録更新を行います。Pause/Restart は `runtime.stop()` / `runtime.start()` によるため、タイマー/イベントの解放と再登録が idempotent であることを各モジュールで確認してください。
