<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ミニゲーム: ダイアグラムメーカー</title>
    <link rel="stylesheet" href="../manual.css">
</head>
<body>
    <main>
        <h1>ミニゲーム: ダイアグラムメーカー</h1>
        <section>
            <h2>概要</h2>
            <p>
                ダイアグラムメーカーは、MiniExp ユーティリティカテゴリに収録された draw.io 互換の図表制作ツールです。
                1200×720 ピクセルのキャンバス上でノードとコネクタを配置し、PNG/JPG/BMP への画像書き出しや draw.io XML の読み書きに対応します。
                作図操作はミニゲーム EXP とも連動しており、画面下部のフッターに現在の獲得量が表示されます。
            </p>
        </section>
        <section>
            <h2>画面構成</h2>
            <ul>
                <li><strong>タイトルバー</strong>: 現在のファイル名と未保存マーク（*）、および「新規」「開く」「保存」「書き出し」の各ボタンが並びます。書き出しは PNG/JPG/BMP を選べるドロップダウン式です。</li>
                <li><strong>ツールパレット</strong>: 左端に縦配置されており、「選択」「四角」「楕円」「テキスト」「コネクタ」「削除」の 6 種類のツールを切り替えられます。</li>
                <li><strong>キャンバス</strong>: 中央の SVG ベースの作業領域です。グリッドの表示とスナップ挙動はフッターから切り替えられます。</li>
                <li><strong>プロパティパネル</strong>: 右側に表示され、選択中のノード 1 件に対して位置・サイズ・色・文字属性を編集できます。複数選択時は入力欄が無効化されます。</li>
                <li><strong>フッター</strong>: 左側にズームスライダー（25〜200%）、グリッド表示とスナップのトグル、右側に Undo/Redo ボタンと EXP 表示が並びます。</li>
            </ul>
        </section>
        <section>
            <h2>ファイル操作</h2>
            <ul>
                <li><strong>新規</strong>: 未保存の変更がある場合は確認ダイアログのあと、空の図面を初期レイヤー込みで再生成します。</li>
                <li><strong>開く</strong>: <code>.drawio</code> / <code>.dio</code> / <code>.xml</code> のほか、埋め込みデータを含む PNG/JPG/BMP から draw.io XML を抽出して読み込めます。</li>
                <li><strong>保存</strong>: 現在の図面を draw.io 互換 XML としてダウンロードします。保存後は未保存マークが消え、ローカルストレージへ状態が書き戻されます。</li>
                <li><strong>書き出し</strong>: 現在のキャンバスを描画して PNG/JPG/BMP のいずれかをダウンロードします（JPG/BMP の背景は白で塗りつぶされます）。</li>
            </ul>
            <p class="small-note">
                ファイル名・ズーム・グリッド/スナップ設定・直近の図面はローカルストレージに保持され、次回起動時に復元されます。
                さらに、未保存の変更が続く場合は 60 秒ごとに自動保存スロット（最大 5 件）へスナップショットを記録します。
            </p>
        </section>
        <section>
            <h2>ツールの使い方</h2>
            <dl>
                <dt>選択</dt>
                <dd>ノードをクリックすると選択され、ドラッグで移動できます。Shift クリックや範囲選択は未実装です。</dd>
                <dt>四角 / 楕円</dt>
                <dd>キャンバスをクリックした位置に 160×90 ピクセルのノードが追加されます。矩形は角丸 6px、楕円は中心半径で描画されます。</dd>
                <dt>テキスト</dt>
                <dd>160×60 ピクセルのテキストノードを追加します。文字列はプロパティパネルのテキスト欄から編集します。</dd>
                <dt>コネクタ</dt>
                <dd>始点ノードをクリックしたあと、終点ノードをクリックすると矢印付きの直線コネクタが生成されます。ドラッグ中は点線プレビューが表示されます。</dd>
                <dt>削除</dt>
                <dd>対象ノードまたはコネクタをクリックすると、その要素と接続関係を削除します。</dd>
            </dl>
        </section>
        <section>
            <h2>プロパティ編集</h2>
            <p>
                単一ノードが選択されているときは、プロパティパネルから次の項目を更新できます。
            </p>
            <ul>
                <li><strong>X / Y</strong>: 左上座標（グリッドスナップ有効時は 10px 単位に丸められます）。</li>
                <li><strong>幅 / 高さ</strong>: ノードサイズ。最小値は 10px です。</li>
                <li><strong>塗り / 線 / 線幅</strong>: 塗りつぶし色、枠線色、線幅。</li>
                <li><strong>文字色 / 文字サイズ / テキスト</strong>: 文字スタイルと本文。値を変更すると即座にキャンバスへ反映され、履歴にも記録されます。</li>
            </ul>
            <p>
                プロパティを変更した場合は未保存フラグが立ち、自動保存の対象になります。
            </p>
        </section>
        <section>
            <h2>補助機能とショートカット</h2>
            <ul>
                <li>ズームスライダーで 25〜200% の拡大率を切り替えられます。倍率表示はフッター左側に反映されます。</li>
                <li>グリッド表示とスナップは独立して切り替え可能です。スナップを無効にするとドラッグ・追加時の丸め処理がなくなります。</li>
                <li>Undo/Redo は最大 100 ステップの履歴を保持し、ショートカット Ctrl+Z / Ctrl+Shift+Z（または Ctrl+Y）も利用できます。</li>
                <li>Delete キーで選択中の要素を削除できます。</li>
                <li>システムのライト/ダークテーマに追従して配色が自動調整されます。</li>
            </ul>
        </section>
        <section>
            <h2>EXP の獲得</h2>
            <p>
                ダイアグラムメーカーは操作内容に応じて EXP を付与します。付与額には 5 秒のクールダウンがあり、同じ操作の連打で増殖しないよう制御されています。
            </p>
            <table>
                <thead>
                    <tr><th>アクション</th><th>EXP</th><th>備考</th></tr>
                </thead>
                <tbody>
                    <tr><td>ツール起動（初期表示）</td><td>+5</td><td>起動直後に付与されます。</td></tr>
                    <tr><td>ノード編集</td><td>+2</td><td>追加・移動・削除などの形状操作。</td></tr>
                    <tr><td>コネクタ編集</td><td>+2</td><td>追加や接続の更新。</td></tr>
                    <tr><td>外部ファイル読込</td><td>+8</td><td>draw.io XML / 画像からのインポート。</td></tr>
                    <tr><td>XML 保存</td><td>+10</td><td>「保存」で出力した際に加算。</td></tr>
                    <tr><td>画像書き出し</td><td>+6</td><td>PNG/JPG/BMP のいずれかをエクスポート。</td></tr>
                </tbody>
            </table>
        </section>
        <section>
            <h2>既知の制限</h2>
            <ul>
                <li>レイヤーの追加・並べ替え UI は未実装ですが、インポートした図面のレイヤー属性は維持されます。</li>
                <li>複数選択やドラッグ選択はサポートしていません。必要に応じてノードを個別に編集してください。</li>
                <li>コネクタのポイント編集や曲線化、矢印スタイル変更は行えません。</li>
            </ul>
        </section>
    </main>
</body>
</html>
