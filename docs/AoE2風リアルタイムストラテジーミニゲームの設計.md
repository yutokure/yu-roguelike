# AoE2風リアルタイムストラテジーミニゲームMOD 設計書

## コンセプト
* 町の発展と軍備をテンポ良く楽しめるAoE2風の簡易RTS。
* 10〜15分の短時間プレイで「内政→小規模な防衛戦→最終決戦」の流れを味わう。
* シングルプレイ専用。プレイヤーは小さな入植地を指揮し、ウェーブで襲来する敵部隊を撃退しつつ敵の本陣を破壊することが目標。

## ゲームサイクル
1. **内政フェーズ** — 初期の村人と資源で農民を増やし、木材・金・食料を確保する。
2. **軍備フェーズ** — 兵舎・弓兵小屋を建設し、歩兵と弓兵を訓練。家を建てて人口上限を拡張する。
3. **防衛フェーズ** — 90秒おきに来襲する敵ウェーブを撃退する。ウェーブは全3回で、最後は敵将軍が率いる混成軍。
4. **決戦フェーズ** — 敵のタウンセンターを破壊すれば勝利。自軍のタウンセンターを失うと敗北。

## フィールドとUI
* 800×520pxの戦場キャンバスと、左右に情報パネルを配置。
* 左上に資源表示（食料/木材/金/石、人口）。
* 右上に次のウェーブタイマーとミニマップ。
* 画面下部に選択中ユニット/建物の詳細パネルとアクションボタン。
* 左下にイベントログ、右下に研究・内政ブーストなどのタイムラインバッジ。

## ユニット
| 種類 | 役割 | 特徴 |
| --- | --- | --- |
| 村人 | 資源採集と建築 | 近接攻撃力は低い。食料50で訓練。資源採集速度を種類ごとに設定。 |
| 民兵 | 序盤の近接兵 | 食料60＋金20。近接攻撃、敵歩兵に有利。 |
| 弓兵 | 遠距離支援 | 木材50＋金40。遠距離攻撃とカイト行動。 |
| 斥候 | 中立キャンプから雇用できる高速偵察騎兵。金75。 |
| 敵ユニット | 野盗（軽歩兵）、弓騎兵、破城槌などウェーブごとに構成が変化。 |

## 建物
| 建物 | 説明 |
| --- | --- |
| タウンセンター | 拠点。村人訓練と人口上限10を提供。破壊されると敗北。 |
| 家 | 人口上限＋5。建築時間短い。木材50。 |
| 兵舎 | 民兵系ユニットの訓練。木材175。 |
| 弓兵小屋 | 弓兵系ユニットの訓練。木材200＋金50。 |
| 市場 | 資源交換と研究。木材150＋金75。 |
| 見張り塔 | 防衛構造物。木材125＋石125。自動で矢を放つ。 |

建築は村人を選択して建築モードに入り、キャンバス上をクリックして建設。建設中はHP50%の未完成状態で、村人が作業して完成させる。

## 資源と経済
* 食料／木材／金／石の4資源。
* 狩猟小屋・木立・鉱山などの資源ノードをキャンバス内に配置。残量が0になると消滅。
* 村人が資源ノードで作業すると、数秒ごとに資源が倉庫（タウンセンター）に自動搬入される。
* 市場建設後は資源レートを手動で交換できる（20%手数料）。

## コマンド操作
* 左クリックで選択、ドラッグで範囲選択。
* 右クリックで移動・攻撃・採集コマンドをコンテキストに応じて実行。
* アクションボタン（建築/訓練/研究）は詳細パネルから実行。
* スペースキーで最新イベント箇所へカメラジャンプ。

## 敵ウェーブ設計
1. **波1 (90秒)** — 野盗×6、弓騎兵×2。EXP 120。
2. **波2 (180秒)** — 野盗×10、破城槌×1。EXP 180。
3. **波3 (270秒)** — 野盗×12、弓騎兵×4、将軍(HP高い)。撃破すると敵TCのHPが大幅減少。

ウェーブ撃破時に資源ボーナス＋EXPボーナスを付与。難易度により出現間隔と構成を調整可能。

## EXP獲得
* 資源採集100ごとに+5EXP。
* 建物完成ごとに+12EXP。
* ユニット訓練ごとに+4EXP。
* 敵ユニット撃破で種類に応じて+3〜+12EXP。
* ウェーブ撃破＋塔/市場研究完了で大きなボーナス。

## 研究システム
* 市場：採集速度+10%、矢羽根強化（弓兵攻撃力+1）。
* 兵舎：鍛冶場併設で歩兵防御+1。
* タウンセンター：領主進化（人口上限+10＋資源配分UI開放）。

## 勝敗条件
* 勝利：敵タウンセンター(HP3000)を破壊するか、全ウェーブ撃破後に出現する司令官を倒す。
* 敗北：自軍タウンセンターが破壊される、または全村人を失い経済が途絶。

## 追加要素（オプション）
* 達成項目（ノーロスト、10分以内クリアなど）。
* マルチ難易度（EASY/NORMAL/HARDで資源量と敵編成調整）。
* セーブ/ロード用のシリアライズ。

## 実装メモ
* 2Dキャンバスにシンボリックなドット絵風アイコンを描画。
* シンプルな自動経路探索（A*簡易グリッド）とステアリング行動。
* メインループは`requestAnimationFrame`＋固定時間ステップで更新。
* ゲーム状態は`state`オブジェクトに集約し、UIと描画を再レンダリング。

