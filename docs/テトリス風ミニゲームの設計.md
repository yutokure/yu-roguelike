# テトリス風ミニゲームの設計

本設計は「ミニゲームAPI書（MiniExp MOD API v0.1）」準拠。ワールドルールを参考にし、RENとT-Spinを実装します。行消し/ハードドロップ/T-SpinでEXPを付与します。

- ID: `tetris`
- 表示名: テトリス風
- エントリ: `games/tetris.js`
- バージョン: 0.1.0

## ルール/操作
- ←/→: 移動、↓: ソフトドロップ、↑ or Space: ハードドロップ、Z/X: 回転、C: ホールド（任意）。
- 7バッグ乱数。壁蹴り（SRS簡易）。
- REN: 連続で行を消すたびにカウント+1。行を消さない配置で0にリセット。
- T-Spin判定: Tピース回転入れ、3隅判定ベース。miniは扱いなし（またはsingle扱い）。

## 難易度
- EASY: 重力低、ロック遅、ガーベージなし。
- NORMAL: 重力中、ロック既定、ガーベージ少（任意）。
- HARD: 重力高、ロック早、ガーベージあり（任意）。

## EXP 仕様（必須要件の反映）
- ハードドロップ: +1 EXP。
- 1ライン消し: +2 EXP。
- 2ライン同時: +5 EXP。
- 3ライン同時: +10 EXP。
- 4ライン同時: +25 EXP。
- REN: 上記「ライン消しのEXP」× `1.5 ^ REN数` を追加倍率として適用。
- T-Spin single: +4 EXP。
- T-Spin double: +15 EXP。
- T-Spin triple: +75 EXP。

注: T-Spinで行消しが発生した場合は、通常の行消しEXPの代わりにT-Spin側のEXPを用い、REN倍率はT-Spin EXPにも適用します。ハードドロップの+1は別途付与されます。

## 記録/スコア
- `getScore()` = `totalLinesCleared`（合計消去ライン）または `totalExpEarnedThisRun` のどちらか。既定は前者。

## UI/演出
- 右: ホールド/次キュー、下: RENカウンタ表示（色段階）。
- 行消し/REN/T-Spinで `#miniexp-hud` にバッジ（RENは `combo` バリアント）

## 実装方針（API連携）
- `create(root, awardXp, { difficulty })`:
  - 盤/バッグ/入力/ロック/消去処理。消去確定フレームでEXP計算し `awardXp(gained,{type:'line'|'tspin', ren})`。
  - ハードドロップ入力確定時に `awardXp(1,{type:'harddrop'})`。
- 1フレーム内に複数イベントがある場合は、ゲーム内で合算後に1回の `awardXp` を推奨（HUDスパム抑制）。

## エラー/ガード
- ロックアウト/ゲームオーバー処理の安定、ガーベージ注入の境界チェック。

## manifest.json 例
```json
{ "id": "tetris", "name": "テトリス風", "entry": "games/tetris.js", "version": "0.1.0", "description": "REN×1.5^n / T-Spin対応", "category": "パズル" }
```
