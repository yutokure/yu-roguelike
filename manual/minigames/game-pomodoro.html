<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ミニゲーム: ポモドーロタイマー</title>
    <link rel="stylesheet" href="../manual.css">
</head>
<body>
    <main>
        <h1>ミニゲーム: ポモドーロタイマー</h1>

        <section>
            <h2>概要</h2>
            <p>
                ポモドーロタイマーは、集中と休憩をリズム良く切り替えながら経験値（EXP）を獲得できるユーティリティ系ミニゲームです。
                1回の集中セッションを完了するたびに XP ボーナスが得られ、短休憩・長休憩の完了でも追加の XP を獲得できます。
                進捗はブラウザのローカルストレージに保存されるため、ページを閉じても設定や履歴が維持されます。
            </p>
        </section>

        <section>
            <h2>画面構成</h2>
            <ul>
                <li><strong>フェーズバッジ</strong>: 現在のモード（集中 / 小休憩 / 長休憩）を表示します。色で状態が識別できます。</li>
                <li><strong>タイマー表示</strong>: 残り時間を mm:ss 形式で表示します。進捗バーが残り割合に応じてアニメーションします。</li>
                <li><strong>コントロールボタン</strong>: 「開始 / 一時停止」「スキップ」「リセット」の3種類。</li>
                <li><strong>ステータスチップ</strong>: 集中回数、休憩回数、現在の連続達成数、累積 XP をカード形式で表示します。</li>
                <li><strong>サマリー</strong>: 当日の実績と長休憩までの残り集中回数を表示します。</li>
                <li><strong>次のフェーズ予告</strong>: 次に予定されているフェーズと時間を案内します。</li>
                <li><strong>履歴</strong>: 直近最大60日の集中 / 休憩 / XP 実績を一覧表示します。</li>
                <li><strong>設定パネル</strong>: 集中・休憩の長さや自動開始設定などを調整できます。</li>
            </ul>
        </section>

        <section>
            <h2>基本的な使い方</h2>
            <ol>
                <li>初期状態では <strong>集中 25分 / 小休憩 5分 / 長休憩 15分 / 長休憩まで4サイクル</strong> に設定されています。</li>
                <li>「開始」を押すと現在のフェーズのカウントダウンがスタートします。ボタンは進行中「⏸ 一時停止」に切り替わります。</li>
                <li>カウントが0になるとフェーズ完了となり、自動で次のフェーズへ移行します。<br>
                    集中完了後はサイクルに応じて小休憩または長休憩へ、休憩完了後は必ず集中へ戻ります。</li>
                <li>フェーズ完了と同時に該当する XP が付与され、ステータスに反映されます。</li>
                <li>自動開始が有効になっているフェーズでは、完了直後に次フェーズのカウントダウンが自動的に始まります。</li>
            </ol>
        </section>

        <section>
            <h2>フェーズとサイクル</h2>
            <p>集中フェーズを完了するたびに「集中セッション達成」となり、次のフェーズは以下のルールで決まります。</p>
            <ul>
                <li>長休憩までの必要集中回数は設定の「長休憩までの回数」で決まります（初期値4、最小2〜最大8）。</li>
                <li>必要回数に到達するまでは短休憩、到達したタイミングの次は長休憩が割り当てられます。</li>
                <li>スキップすると集中連続数とサイクルカウントはリセットされ、XPも獲得できません。</li>
                <li>長休憩フェーズの完了後は自動的に集中フェーズに戻ります。</li>
            </ul>
        </section>

        <section>
            <h2>XP ルール</h2>
            <ul>
                <li><strong>集中フェーズ完了</strong>: 基本 50 XP に加え、連続達成数に応じて最大 +40 XP のボーナスが入ります。</li>
                <li><strong>短休憩完了</strong>: 12 XP。</li>
                <li><strong>長休憩完了</strong>: 25 XP。</li>
                <li>各 XP はセッション内合計だけでなく累積値・当日値にも加算され、必要に応じてバッジ演出が表示されます。</li>
            </ul>
        </section>

        <section>
            <h2>操作ボタン</h2>
            <dl>
                <dt>開始 / ⏸ 一時停止</dt>
                <dd>フェーズの進行を切り替えます。一時停止中はカウントが減りません。</dd>
                <dt>スキップ</dt>
                <dd>現在のフェーズを完了扱いにせず即座に次フェーズへ移動します。集中フェーズ残り時間が20%未満の間は進行中の安全装置として無効になります。</dd>
                <dt>リセット</dt>
                <dd>現在のフェーズの残り時間を初期値に戻します。集中フェーズでリセットすると連続達成数もリセットされます。</dd>
            </dl>
        </section>

        <section>
            <h2>設定項目</h2>
            <p>右側の設定パネルでは各パラメータを数値入力とトグルで変更できます。</p>
            <table class="setting-table">
                <thead>
                    <tr>
                        <th>項目</th>
                        <th>説明</th>
                        <th>入力範囲 / 初期値</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>集中時間</td>
                        <td>集中フェーズ1回分の長さ（分）。</td>
                        <td>5〜180 / 初期値25</td>
                    </tr>
                    <tr>
                        <td>短休憩</td>
                        <td>短休憩フェーズの長さ（分）。</td>
                        <td>1〜60 / 初期値5</td>
                    </tr>
                    <tr>
                        <td>長休憩</td>
                        <td>長休憩フェーズの長さ（分）。</td>
                        <td>5〜180 / 初期値15</td>
                    </tr>
                    <tr>
                        <td>長休憩までの回数</td>
                        <td>長休憩を挟むまでに必要な集中セッション数。</td>
                        <td>2〜8 / 初期値4</td>
                    </tr>
                    <tr>
                        <td>休憩を自動開始</td>
                        <td>集中完了時に、休憩フェーズを即座にスタートさせます。</td>
                        <td>オン / オフ（初期オン）</td>
                    </tr>
                    <tr>
                        <td>集中を自動開始</td>
                        <td>休憩完了時に、集中フェーズを自動で開始します。</td>
                        <td>オン / オフ（初期オフ）</td>
                    </tr>
                </tbody>
            </table>
            <p>値を変更したら「設定を保存」ボタンで反映します。保存時には確認用のバッジ通知が表示されます。</p>
        </section>

        <section>
            <h2>履歴と統計</h2>
            <ul>
                <li>履歴は日付ごとの集中回数、休憩回数（短休憩 + 長休憩）、獲得 XP を表示します。最大60日分が保存され、最新7日が一覧に並びます。</li>
                <li>ステータスチップの連続達成数は、休憩フェーズに入るかスキップするとリセットされます。最高連続数は内部的に記録され、XP ボーナス計算に利用されます。</li>
                <li>当日サマリーでは現時点の集中 / 休憩回数と当日の獲得 XP 合計が確認できます。</li>
            </ul>
        </section>

        <section>
            <h2>活用のヒント</h2>
            <ul>
                <li>集中フェーズ中に予定外の離席が発生した場合は一時停止を活用し、無理にスキップしないことで連続ボーナスを維持できます。</li>
                <li>長時間作業する際は、長休憩までの回数や各フェーズ時間を調整して自分の集中リズムに合わせましょう。</li>
                <li>連続達成ボーナスは最大 +40 XP まで伸びるため、数サイクルまとめて進めると効率的に EXP を稼げます。</li>
            </ul>
        </section>

        <section>
            <h2>トラブルシューティング</h2>
            <ul>
                <li>ブラウザのプライベートモードやストレージ制限が有効だと履歴・設定が保存されない場合があります。通常モードでの利用を推奨します。</li>
                <li>タイマーが進行しない場合は、タブがバックグラウンドで一時停止されていないか確認してください（ブラウザの省電力設定に影響されることがあります）。</li>
                <li>リセットしても時間が戻らない場合は、入力値が許容範囲内（上記表を参照）であるか確認し、設定を保存し直してください。</li>
            </ul>
        </section>
    </main>
</body>
</html>
