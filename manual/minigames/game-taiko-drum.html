<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ミニゲーム: 太鼓リズム</title>
    <link rel="stylesheet" href="../manual.css">
</head>
<body>
    <main>
        <h1>ミニゲーム: 太鼓リズム</h1>
        <section>
            <h2>概要</h2>
            <p>
                太鼓リズムは、2 レーンで譜面を叩く太鼓の達人風ミニゲームです。難易度ごとにテンポと譜面が用意されており、
                <strong>ドン（赤）</strong> と <strong>カッ（青）</strong> をタイミングよく入力して精度とコンボを伸ばします。
                判定とコンボに応じて EXP が算出され、楽曲終了後に結果サマリーとクリアボーナスが表示されます。
            </p>
            <ul>
                <li>カテゴリ: リズムアクション</li>
                <li>プレイ時間目安: 1 曲 90〜110 秒（難易度により変動）</li>
                <li>スコア指標: 判定ごとの EXP と最大コンボ</li>
            </ul>
        </section>
        <section>
            <h2>ゲームの流れ</h2>
            <ol>
                <li>画面下部のセレクタで難易度を選び、<strong>スタート</strong> を押すと 0.6 秒後に譜面が流れ始めます。</li>
                <li>ノーツは右端からヒットサークルへ約 2.2 秒かけて移動し、位置が重なった瞬間に入力判定が行われます。</li>
                <li>譜面終了後は自動でリザルトが表示され、判定内訳・最大コンボ・総 EXP・クリアボーナスが確認できます。</li>
            </ol>
            <p class="tip">このミニゲームに強制失敗条件はなく、譜面終了まで最後まで演奏できます。</p>
        </section>
        <section>
            <h2>操作と UI</h2>
            <ul>
                <li><strong>キーボード入力:</strong> F / J / Space がドン、D / K がカッ。大音符は両方のレーンを素早く 2 回打ちます。</li>
                <li><strong>タップ・クリック:</strong> キャンバスの左側（赤円）でドン、右側（青円）でカッ。ドラッグ中に範囲外へ離れるとタップが解除されます。</li>
                <li>HUD には進行度、判定内訳、現在コンボと精度、獲得 EXP が常時表示されます。</li>
                <li>難易度セレクトは演奏中ロックされ、終了後に再び変更できます。</li>
            </ul>
            <p>
                入力すると対応レーンが発光し、成功時はコンボが加算されます。未入力のままヒットサークルを通過したノーツは自動でミス判定となります。
            </p>
        </section>
        <section>
            <h2>難易度と譜面</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>難易度</th>
                            <th>BPM</th>
                            <th>総ノーツ数<br>(大音符)</th>
                            <th>判定幅 良</th>
                            <th>判定幅 可</th>
                            <th>判定幅 普</th>
                            <th>コンボ補正</th>
                            <th>大音符ボーナス</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>EASY</td>
                            <td>110</td>
                            <td>22 (0)</td>
                            <td>±46 ms</td>
                            <td>±96 ms</td>
                            <td>±140 ms</td>
                            <td>0.24</td>
                            <td>+2.4 EXP</td>
                        </tr>
                        <tr>
                            <td>NORMAL</td>
                            <td>132</td>
                            <td>37 (4)</td>
                            <td>±42 ms</td>
                            <td>±84 ms</td>
                            <td>±128 ms</td>
                            <td>0.32</td>
                            <td>+2.8 EXP</td>
                        </tr>
                        <tr>
                            <td>HARD</td>
                            <td>152</td>
                            <td>45 (11)</td>
                            <td>±36 ms</td>
                            <td>±72 ms</td>
                            <td>±118 ms</td>
                            <td>0.38</td>
                            <td>+3.0 EXP</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <p>
                いずれの譜面も 16 分音符間隔で構成され、譜面文字列に含まれる大文字（<code>D</code> / <code>K</code>）が大音符を示します。
                大音符は判定枠内で 2 回ヒットさせる必要があり、2 回のうち悪い判定が最終判定として採用されます。
            </p>
        </section>
        <section>
            <h2>判定と EXP 計算</h2>
            <ul>
                <li>判定は上から「良」「可」「普」「不」。ヒットタイミングのズレが大きいほど下位判定になります。</li>
                <li>各判定で得られる基礎 EXP:
                    <ul>
                        <li>EASY: 良 5.8 / 可 3.2 / 普 1.4</li>
                        <li>NORMAL: 良 6.6 / 可 3.6 / 普 1.6</li>
                        <li>HARD: 良 7.4 / 可 4.0 / 普 1.8</li>
                    </ul>
                </li>
                <li>コンボが 1 以上のとき、ヒット前コンボ数 ×「コンボ補正」ぶんの EXP が上乗せされます。</li>
                <li>大音符を判定内に収めると難易度ごとのボーナス EXP が追加されます。</li>
                <li>曲終了時には <code>max(0, 10 + 最大コンボ × 0.6 + 良数 × 0.4)</code> のクリアボーナスが付与されます。</li>
                <li>HUD の精度表示は <code>(良 + 0.6 × 可 + 0.3 × 普) ÷ 総ノーツ × 100</code> の式で算出されています。</li>
            </ul>
        </section>
        <section>
            <h2>攻略のヒント</h2>
            <ul>
                <li>大音符は最初の入力から判定枠（普判定幅）内に 2 回目を入れる必要があるため、左右両方を同時に叩くイメージで素早く連打しましょう。</li>
                <li>コンボ補正が高めなので、リズムを崩さずコンボを伸ばすと EXP の伸びも大きくなります。</li>
                <li>タップ操作ではレーン外に指が移動すると入力が解除されるため、長押しよりも都度タップする方が安定します。</li>
            </ul>
        </section>
        <section>
            <h2>トラブルシューティング</h2>
            <ul>
                <li>入力が反応しない場合はブラウザがキャンバスをフォーカスしているか確認し、別ウィンドウが選択されていないかをチェックしてください。</li>
                <li>描画がカクつく場合は他タブを閉じるか、EASY など BPM の低い譜面でプレイすると入力が合わせやすくなります。</li>
            </ul>
        </section>
    </main>
</body>
</html>
