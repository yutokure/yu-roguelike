<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ミニゲーム: ダンジョンタワーディフェンス</title>
    <link rel="stylesheet" href="../manual.css">
</head>
<body>
    <main>
        <h1>ミニゲーム: ダンジョンタワーディフェンス</h1>
        <section>
            <h2>概要</h2>
            <p>
                ダンジョンタワーディフェンスは、MiniExp のダンジョンAPIで生成されるランダムなフロアを舞台に、敵のウェーブからコアを守るタワーディフェンス型ミニゲームです。
                砲塔を設置・強化しながら全ウェーブを凌ぎ切ると完全防衛ボーナスが獲得できます。
            </p>
            <ul>
                <li>カテゴリ: アクション / タワーディフェンス</li>
                <li>プレイ時間目安: 5〜10 分（難易度により変動）</li>
                <li>得点指標: 防衛したウェーブ数（スコア画面に反映）</li>
            </ul>
        </section>
        <section>
            <h2>ゲームの流れ</h2>
            <ol>
                <li>開始時に <strong>混合型</strong> のダンジョンフロア（44×32 タイル, タイルサイズ 20）が自動生成され、通路とコア位置が決定されます。</li>
                <li>砲塔を配置して防衛ラインを整えたら、<strong>ウェーブ開始</strong> ボタンで敵の進行を呼び込みます。</li>
                <li>敵は通路タイルに沿ってスポーン地点からコアへ向かいます。コア耐久が 0 になる前に全ウェーブを退ければ勝利です。</li>
            </ol>
            <p class="tip">
                経路生成に失敗した場合はステータス欄に再読込メッセージが表示されます。その際はゲームを閉じて再起動してください。
            </p>
        </section>
        <section>
            <h2>操作とUI</h2>
            <ul>
                <li><strong>クリック:</strong> 床タイルに砲塔を設置（通路・コア・スポーン位置は不可）。</li>
                <li><strong>Shift + クリック:</strong> 既存砲塔を強化。</li>
                <li><strong>ウェーブ開始ボタン:</strong> 次のウェーブを開始。進行中はホスト側の R / P ショートカットが自動で無効化されます。</li>
            </ul>
            <p>
                画面上部の HUD には現在ウェーブ数、所持資金、コア耐久、累計獲得EXPが表示され、右下のステータス欄に進行状況や警告が流れます。
                ヒントパネルには操作の概要が常時表示されるため、初回プレイでも手順を追いやすい構成です。
            </p>
        </section>
        <section>
            <h2>難易度別パラメータ</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>難易度</th>
                            <th>コア耐久</th>
                            <th>初期資金</th>
                            <th>砲塔コスト</th>
                            <th>基礎強化費</th>
                            <th>敵ダメージ</th>
                            <th>最大ウェーブ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>EASY</td>
                            <td>30</td>
                            <td>160 G</td>
                            <td>38 G</td>
                            <td>45 G</td>
                            <td>1</td>
                            <td>10</td>
                        </tr>
                        <tr>
                            <td>NORMAL</td>
                            <td>24</td>
                            <td>135 G</td>
                            <td>48 G</td>
                            <td>55 G</td>
                            <td>1</td>
                            <td>12</td>
                        </tr>
                        <tr>
                            <td>HARD</td>
                            <td>18</td>
                            <td>110 G</td>
                            <td>56 G</td>
                            <td>65 G</td>
                            <td>2</td>
                            <td>12</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <p>
                砲塔の基本性能（射程 4.0〜4.6 タイル、基礎ダメージ 18〜22、発射間隔 0.68〜0.8 秒）も難易度によって微調整されています。
                防衛ラインが厳しいほど射程と発射速度が抑えられるため、配置と強化のバランスが鍵になります。
            </p>
            <ul>
                <li><strong>EASY:</strong> 射程 4.6 タイル / ダメージ 18 / 発射間隔 0.8 秒。敵HP 65 + 18×(wave-1)、速度 42、撃破報酬 18、Kill EXP 6、ウェーブボーナス EXP 30、資金ボーナス 28、スポーン間隔 1.2 秒。</li>
                <li><strong>NORMAL:</strong> 射程 4.2 タイル / ダメージ 20 / 発射間隔 0.75 秒。敵HP 80 + 22×(wave-1)、速度 50、撃破報酬 22、Kill EXP 8、ウェーブボーナス EXP 36、資金ボーナス 32、スポーン間隔 1.05 秒。</li>
                <li><strong>HARD:</strong> 射程 4.0 タイル / ダメージ 22 / 発射間隔 0.68 秒。敵HP 110 + 26×(wave-1)、速度 58、撃破報酬 26、Kill EXP 10、ウェーブボーナス EXP 42、資金ボーナス 34、スポーン間隔 0.92 秒。</li>
            </ul>
        </section>
        <section>
            <h2>敵ウェーブと砲塔</h2>
            <h3>敵の出現</h3>
            <ul>
                <li>1ウェーブあたり <code>floor(6 + wave × 2.5)</code> 体が出現し、難易度ごとのスポーン間隔（1.2 / 1.05 / 0.92 秒）で送られます。</li>
                <li>敵体力は <code>(基礎HP + 成長量 × (wave - 1)) × (1 + 0.18 × (wave - 1))</code> で決定。速度も <code>1 + 0.05 × (wave - 1)</code> 倍、撃破報酬は <code>1 + 0.12 × (wave - 1)</code> 倍まで成長します。</li>
                <li>コア到達時には敵ダメージ分だけ耐久が減少します。耐久が 0 になると即敗北です。</li>
            </ul>
            <h3>砲塔の特性</h3>
            <ul>
                <li>砲塔は最前列の敵を優先攻撃し、弾が命中するとビームエフェクトが描画されます。</li>
                <li>強化費用は <code>floor(基礎強化費 × 1.35<sup>レベル-1</sup>)</code> で増加。レベル毎にダメージ ×1.32、射程 ×1.06、発射間隔 ×0.88（下限 0.32 秒）。</li>
                <li>通路タイル・コア・スポーン地点・既存砲塔には設置できません。設置不可の場合はステータス欄に理由が表示されます。</li>
            </ul>
        </section>
        <section>
            <h2>報酬とスコア</h2>
            <ul>
                <li>敵撃破ごとに資金と EXP を獲得（Kill EXP は EASY 6 / NORMAL 8 / HARD 10）。撃破資金は難易度別基礎値（18 / 22 / 26）にウェーブ補正が掛かります。</li>
                <li>ウェーブ完了時に資金ボーナス（28 / 32 / 34 + floor(wave × 1.5)）と EXP（30 / 36 / 42 + wave ×4）を追加取得します。</li>
                <li>全ウェーブ防衛に成功すると追加で 120 EXP の完全防衛ボーナスを受け取れます。</li>
                <li>スコア画面では防衛したウェーブ数が最終記録として送られます。</li>
            </ul>
        </section>
        <section>
            <h2>攻略のヒント</h2>
            <ul>
                <li>初期資金は 2〜3 基分の砲塔設置に使い、敵速度が上がる中盤以降に備えて経路中盤へ射程を重ねましょう。</li>
                <li>砲塔は強化するほど DPS が大幅に向上するため、波ごとのボーナスでこまめに強化費を確保するのが効率的です。</li>
                <li>スポーン直後よりも終盤のカーブに砲塔を集中させると、長時間射線を確保できて撃ち漏らしが減ります。</li>
                <li>コア耐久が減った場合は次ウェーブ開始前に資金を温存し、要所の砲塔強化を優先して防衛ラインを再構築しましょう。</li>
            </ul>
        </section>
        <section>
            <h2>トラブルシューティング</h2>
            <ul>
                <li>「経路の確保に失敗しました」と表示された場合は、ステージ生成の再試行が必要です。一度ゲームを閉じてやり直してください。</li>
                <li>砲塔を設置できないタイルはステータス欄で理由が通知されます。通路や既存砲塔と重なっていないか確認しましょう。</li>
                <li>進行中にブラウザが重い場合は、他のタブを閉じるか低難易度でプレイして敵数を抑えるのが有効です。</li>
            </ul>
        </section>
    </main>
</body>
</html>
