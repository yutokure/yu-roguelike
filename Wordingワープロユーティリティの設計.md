# Wording ワープロユーティリティの設計

MiniExp MOD のユーティリティカテゴリに、Office Word 風のリッチテキストエディタ「Wording」を追加する設計。ドキュメント編集の雰囲気を味わえるようリボン UI やページビューを模した構成とし、書式変更・挿入操作でも EXP が得られるワークフローツールとする。

- ID: `wording`
- 表示名: Wording
- エントリ: `games/wording.js`
- バージョン: 0.1.0
- カテゴリ: ユーティリティ
- 目的: Word ライクなワープロ体験。テキスト編集だけでなく見出しや書式設定、レイアウト操作に対しても報酬を与え、文章作成タスクをゲーム化する。

## 画面レイアウト
1. **ウィンドウフレーム**: フルカラーのグラデーション背景上に 1280x720 相当のホワイトボードを配置。角丸とシャドウでデスクトップアプリのウィンドウを再現し、タイトルバーにドキュメント名とウィンドウ操作ボタンを表示。
2. **タブ付きリボン**: タイトルバー下に `ホーム / 挿入 / レイアウト` タブを並べ、選択中タブのコマンドグループを 3 カラムで表示。各グループはボタンとトグルスイッチをまとめ、Office のリボンライクにボーダーとラベルを付与。
3. **クイックアクセスバー**: リボンの左上に保存、元に戻す、やり直し、印刷などのショートカットアイコンを配置。操作時にツールチップと EXP アニメーションを表示。
4. **ページビュー**: 背景を薄いグレー、中央に A4 比率の白いページを配置。`contenteditable` 領域で段落や書式を保持し、余白を確保。カーソル位置に応じてルーラー表示を更新。
5. **ステータスバー**: 下部にページ、語数、文字数、言語、ズーム率を表示するステータスエリアを配置。ズーム率は +/- ボタンで変更可能。

## 機能概要
- **ドキュメント管理**: 新規、開く、上書き保存、名前を付けて保存、PDF 風にエクスポート（実際は HTML → Blob で `.docx` 風のファイルを保存）。ファイル保存時は `localStorage` に直近ドキュメントも保存。
- **書式設定**: 太字、斜体、下線、取り消し線、ハイライト、文字色、フォントサイズ（9〜72pt）、フォントファミリ（游ゴシック/游明朝/Meiryo/等幅）。段落の左揃え/中央揃え/右揃え/両端揃え、箇条書き/番号付きリスト、インデント増減。
- **見出しスタイル**: `スタイル` グループで `本文 / 見出し1 / 見出し2 / 強調引用` を提供。`document.execCommand('formatBlock', …)` を使用。
- **挿入機能**: 日付・時刻挿入、横罫線、クイック目次（単純な番号付きリストを生成）、スタンプ（emoji）などライトな機能を実装。
- **レイアウト**: ページ余白、列数（1〜3 列）、テーマ（ライト/ダーク紙）の切り替え。テーマ変更時はページ背景色を更新。
- **検索・置換**: Ctrl+F/H で簡易モーダル。検索結果数と現在位置を表示し、次を検索でスクロール。
- **ショートカット**: Ctrl+S/N/O/P/B/I/U/Z/Y、Ctrl+Shift+S、Ctrl+L/E/R/J（整列）、Ctrl+Alt+1/2（見出し切替）、Ctrl+Shift+C/V（書式のコピー・貼り付け風 UI）を提供。

## 状態管理
- `state = { title, savedTitle, contentHTML, savedHTML, zoom, theme, ribbonTab, showRuler, columnCount, lastEditAt, sessionXp }` を保持。
- 永続化は `localStorage['miniexp_wording_v1'] = { title, contentHTML, zoom, theme, columnCount }`。
- `title` はデフォルト `文書1`。保存成功時にファイル名を更新し、タイトルバーに反映。
- `sessionXp` は UI 上の EXP バッジ表示に利用（MiniExp HUD とは別に成果感を提供）。

## EXP 仕様
- 起動時 (`create` 完了) に `awardXp(8, { type:'launch' })`。
- テキスト変更（input イベント）で 800ms クールダウン付き `+1`。
- 書式変更コマンド実行で `+2`。
- ファイル保存/エクスポートで `+6`。
- 検索置換完了や挿入系操作は `+3`。
- 一度の操作で複数コマンドが発火しても加算は 1 回のみ。ヘルパー `grantXp(action, amount, cooldownKey?)` を用意して制御。

## API 実装方針
- `create(root, awardXp)` で DOM を構築。戻り値は `start/stop/destroy/getScore`。
- `start()` で各種イベントリスナー（キーショートカット、入力、選択変更）を登録、`stop()` で解除。
- `destroy()` でリボンなどの参照を解放し、永続化。
- リボンタブ切り替えは `data-tab` 属性を用いて制御。現在のタブに応じて表示するボタン群を切り替え。
- `execCommand` を包む `runCommand(cmd, value?)` を定義し、成功時に `grantXp('format', 2)` などを呼ぶ。
- 保存処理は Blob + `a.download`。`.docx` 互換は不要なため、`.wording.html` として保存。

## 実装手順
1. `games/wording.js` を新規作成し、上記 UI とロジックを実装。特に ribbon UI と `contenteditable` ページを構築。
2. `games/manifest.json.js` にエントリを追記 (`category: 'ユーティリティ'`, `description: '編集+1 / 書式+2 / 保存+6 EXP のワープロ'`)。
3. `window.registerMiniGame({ id:'wording', name:'Wording', ... })` を呼ぶ。
4. テキスト入力、リボン操作、保存、ズーム、テーマ切替、検索モーダルを確認し、XP 付与が機能することを手動確認。

