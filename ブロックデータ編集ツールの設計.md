# ブロックデータ編集ツールの設計

## 目的
ダンジョン生成用の `blockdata.json` を手作業で編集する際のミスや工数を減らすため、
コマンドラインから安全に閲覧・編集できるツールを提供する。

## ツール概要
- ファイル配置: `tools/edit_blockdata.py`
- 実行方法: `python tools/edit_blockdata.py <サブコマンド> [オプション]`
- 対象データ: リポジトリ直下の `blockdata.json`
- 対応配列: `blocks1` / `blocks2` / `blocks3`

## サブコマンド
### list
- 指定したブロック配列の一覧を表示する。
- `--set` (または `--array`) で対象配列を指定。
- `--level` や `--key` を複数指定することでフィルタリングが可能。
- 出力形式は `Lv`、`key`、`name`、`chest`、`type` の概要テーブル。

### show
- `key` を指定して該当ブロックの JSON を整形表示する。
- 現在の値を把握してから更新したい場合に利用。

### add
- 新規ブロックを追加する。
- `--key`、`--name`、`--level`、`--set` は必須。
- オプションで `--size`、`--depth`、`--chest`、`--type`、`--boss-floors` を指定可能。
- 追加時にはキーの重複チェックを行い、整形した上で保存。

### update
- 既存ブロックのフィールドを一部更新する。
- `--boss-floors` は `5,10,15` のようなカンマ区切りで指定。
- 指定されたフィールドのみを上書きし、保存時にフィールド順序を整える。

### delete
- `key` を指定してブロックを削除する。
- 削除後は整形して保存される。

## 共通仕様
- `--data` オプションで別ファイルを明示的に指定可能。
- 保存時は 2 スペースインデントで JSON を整形。
- 配列内のエントリは `level` と `key` でソートして秩序を維持。
- `bossFloors` の入力支援としてカンマ区切りの整数リストを解析。
- 失敗時は `SystemExit` でメッセージを出力し、安全に終了。

## 運用例
1. 既存ブロックの確認: `python tools/edit_blockdata.py list --set blocks1 --level -1`
2. 詳細確認: `python tools/edit_blockdata.py show b1052`
3. 新規追加: `python tools/edit_blockdata.py add --set blocks2 --key new100 --name "実験区画" --level 5 --type maze`
4. 既存更新: `python tools/edit_blockdata.py update b1052 --chest rich --boss-floors 10,20`
5. 削除: `python tools/edit_blockdata.py delete b1052`

## 今後の拡張案
- 複数変更をまとめて適用するバッチモードの追加。
- `type` フィールド候補の補完リスト生成。
- 変更前後の差分を自動表示する機能。
