# インベーダー風ミニゲームの設計

本設計は「ミニゲームAPI書（MiniExp MOD API v0.1）」準拠。エイリアンを撃ち落とす固定画面STG。撃破および全滅でEXPを付与します。

- ID: `invaders`
- 表示名: インベーダー風
- エントリ: `games/invaders.js`
- バージョン: 0.1.0

## ルール/操作
- 自機移動: ← →
- 射撃: Space（連射レート制限あり、弾は1～2発制限）
- 敵: 横往復＋段降下。最下段到達 or 自機被弾でミス。残機0で終了。
- ウェーブ: 全滅で次ウェーブへ（速度上昇）。

## 難易度
- EASY: 4×6隊列、開始速度低、敵弾なし、残機3。
- NORMAL: 5×8隊列、敵ランダム射撃少、開始速度中、残機3。
- HARD: 6×11隊列、敵射撃多、開始速度高、残機2。

## EXP 仕様（必須要件の反映）
- 敵1体撃破: +1 EXP。
- ウェーブ全滅: +50 EXP（1ウェーブごと）。
- 付与はヒット判定完了時に `awardXp()` を呼ぶ。連続撃破は 200ms 窓で合算表示推奨。

## 記録/スコア
- `getScore()` = `totalKills + waveClears*50`（EXP由来の簡易スコア）。
- `bestScore` は最大値で保存。

## UI/演出
- 上: スコア/ウェーブ/残機。
- 被弾/爆発は簡易パーティクル。
- `#miniexp-hud` に「+1 EXP」「+50 EXP」を表示。

## 実装方針（API連携）
- `create(root, awardXp, { difficulty })`:
  - キャンバス生成、ゲームループ（`requestAnimationFrame`）。
  - 当たり判定で敵撃破時に `awardXp(1,{type:'kill'})`。
  - ウェーブ全滅時に `awardXp(50,{type:'wave'})` → 次ウェーブセットアップ。
- `start/stop/destroy`: ループ/リスナー/タイマーの確実な管理。

## エラー/ガード
- 画面外弾のクリップ、弾過多の上限管理、複数回 `destroy()` の安全性。

## manifest.json 例
```json
{ "id": "invaders", "name": "インベーダー風", "entry": "games/invaders.js", "version": "0.1.0", "description": "撃破+1 / 全滅+50EXP", "category": "シューティング" }
```
