<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ミニゲーム: ブロックコードラボ</title>
    <link rel="stylesheet" href="../manual.css">
</head>
<body>
    <main>
        <h1>ミニゲーム: ブロックコードラボ</h1>
        <section>
            <h2>概要</h2>
            <p>
                ブロックコードラボは、Scratch ライクなブロックを組み立てて MiniExp API を安全に試せるビジュアルプログラミング環境です。
                10&times;10 のサンドボックスステージやローカル変数を操作しながら、実行ログや XP 報酬を確認できます。
            </p>
        </section>
        <section>
            <h2>初期セットアップと基本操作</h2>
            <ol>
                <li>画面右上の <strong>新規</strong> を押して初期プロジェクトを作成します。ゲーム開始イベントブロックが自動で配置されます。</li>
                <li>ブロックライブラリからイベントや制御ブロックをドラッグ&ドロップし、ワークスペースに配置します。</li>
                <li>
                    <strong>実行</strong> を押すとステージがリセットされ、ゲーム開始ブロック以下のスクリプトが順番に実行されます。
                    開始ブロックが存在しない場合は警告ログが表示されます。
                </li>
                <li><strong>停止</strong> を押すと実行が中断され、ステージは初期状態に戻ります。</li>
            </ol>
        </section>
        <section>
            <h2>画面構成</h2>
            <h3>ヘッダー</h3>
            <ul>
                <li>
                    左側にプロジェクト名とブロック・変数数のサマリーが表示されます。新規プロジェクト作成時に自動更新され、保存するとメタデータがローカルストレージへ記録されます。
                </li>
                <li>
                    中央の操作ボタンから <strong>新規</strong> / <strong>保存</strong> / <strong>読み込み</strong> / <strong>共有コード</strong> / <strong>実行</strong> / <strong>停止</strong> を利用できます。
                    実行中は停止ボタンのみ有効になり、実行状態バッジが「実行中」に切り替わります。
                </li>
                <li>
                    右側には累積 XP と実行状態のバッジが並びます。XP はローカルに保存されるため、再訪問しても継続して加算されます。
                </li>
            </ul>
            <h3>ライブラリとワークスペース</h3>
            <ul>
                <li>
                    左ペインのカテゴリボタンから「イベント」「アクション」「制御」「変数」「ユーティリティ」を切り替え、対応するブロックを一覧できます。
                    各ブロックには説明文が付き、ドラッグ操作のほかダブルクリックで即座にワークスペースへ追加可能です。
                </li>
                <li>
                    ワークスペースはドラッグで配置したブロックが縦に並ぶエリアです。条件ブロックには「そうでなければ」スタックが自動で表示され、
                    ドラッグ中はハイライトされたドロップゾーンにのみ配置できます。
                </li>
                <li>
                    ブロック右上の ⧉ / × ボタンで複製と削除が行えます。選択中のブロックはハイライトされ、実行時は現在ステップ中のブロックが順次強調表示されます。
                </li>
            </ul>
            <h3>右ペイン</h3>
            <ul>
                <li>
                    上部のステージには 10&times;10 グリッドとプレイヤーキャラクターが表示されます。<code>プレイヤーを移動</code> や <code>タイルを変更</code> ブロックで即座に反映されます。
                </li>
                <li>
                    下部のタブから <strong>ログ</strong> と <strong>変数ウォッチ</strong> を切り替えられます。ログには情報・警告・エラーが色分け表示され、
                    変数ウォッチでは実行中の変数値がリアルタイムに更新されます。
                </li>
            </ul>
            <h3>ツールバー</h3>
            <ul>
                <li>
                    画面下部に Undo / Redo（現在は警告メッセージのみ）、ズームリセット、スナップ切替、グリッド表示切替、実行速度スライダーがあります。
                </li>
                <li>ズームはワークスペース全体に適用され、速度スライダーは 0.25&times;〜3&times; の範囲で Worker 実行速度を制御します。</li>
            </ul>
        </section>
        <section>
            <h2>ブロックカテゴリの概要</h2>
            <dl>
                <dt>イベント</dt>
                <dd>プロジェクト開始やキー入力を受け取るハットブロックです。少なくとも 1 つの開始イベントがないと実行できません。</dd>
                <dt>アクション</dt>
                <dd>プレイヤーの移動やタイル色変更など、ステージに直接作用する命令です。</dd>
                <dt>制御</dt>
                <dd>待機、繰り返し、条件分岐、無限ループ（512 回で自動停止）などのフロー制御を提供します。</dd>
                <dt>変数</dt>
                <dd>変数の作成・代入・加算が行えます。変数名は左ペインのリストから追加できます。</dd>
                <dt>ユーティリティ</dt>
                <dd>ログ出力や XP 付与など、開発時の補助機能です。</dd>
            </dl>
        </section>
        <section>
            <h2>変数管理</h2>
            <ul>
                <li>
                    「変数を追加」ボタンから名前・型・初期値を設定すると、プロジェクトに保存されワークスペースの変数ブロックから選択できます。
                </li>
                <li>変数リストの削除ボタンで即時削除が可能です。削除後はワークスペースやサマリーが自動更新されます。</li>
                <li>実行時は Worker 内で変数テーブルが初期化され、初期値が投入されたあと変数ウォッチへ同期されます。</li>
            </ul>
        </section>
        <section>
            <h2>実行とサンドボックス挙動</h2>
            <ul>
                <li>実行すると専用 Web Worker が生成され、ステージと変数状態が隔離されます。実行終了時には自動停止し、必要に応じてワーカースレッドが破棄されます。</li>
                <li>ステージは毎回リセットされ、プレイヤーは中央 (4,4) の黄色ピクセルから開始します。タイル色は <code>#RRGGBB</code> 形式のみ受け付けられます。</li>
                <li>速度スライダーで指定した倍率に応じ、待機時間や移動アニメーションがスケーリングされます。</li>
                <li>条件式は安全なフィルタを通して評価され、無効な表現は 0 とみなされます。文字列リテラルや数値演算も制限付きで扱えます。</li>
                <li>無限ループブロックは 512 回で自動的に停止し、警告ログが出力されます。停止ボタンでもいつでも中断可能です。</li>
            </ul>
        </section>
        <section>
            <h2>XP と実績</h2>
            <ul>
                <li>ラボを開いた時点で 5 XP、ブロックを 5 個追加するたびに 2 XP、スクリプト実行完了で 8 XP が加算されます。</li>
                <li><code>XP を獲得</code> ブロックを使えば実行中に任意量の XP を付与できますが、値は &minus;100〜1,000 の範囲に制限されます。</li>
                <li>獲得した XP はローカルストレージに保存され、XP バッジやメッセージで進捗を確認できます。</li>
            </ul>
        </section>
        <section>
            <h2>プロジェクトの保存・共有</h2>
            <ul>
                <li><strong>保存</strong> はブラウザのローカルストレージに最大 10 件まで記録され、一覧から最新順でロードできます。</li>
                <li><strong>共有コード</strong> は Base64 文字列としてエクスポートされます。コピーしたコードを共有相手がダイアログに貼り付ければ、同じプロジェクトを復元できます。</li>
                <li>共有コードの解析に失敗した場合は警告が表示され、プロジェクトは変更されません。</li>
            </ul>
        </section>
        <section>
            <h2>トラブルシューティング</h2>
            <ul>
                <li>開始イベントが無いまま実行すると警告ログが表示され、ステージは更新されません。必ずハットブロックを配置してください。</li>
                <li>共有コードの貼り付けに失敗した場合は形式が正しいか確認し、余分な空白を削除して再試行してください。</li>
                <li>ループが規定回数を超えると自動停止します。必要なら繰り返し回数を制限するか、停止ボタンで中断してください。</li>
            </ul>
        </section>
    </main>
</body>
</html>
