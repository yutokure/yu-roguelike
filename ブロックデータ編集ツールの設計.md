# ブロックデータ編集ツールの設計

## 目的
BlockDim 用の `blockdata.json` をゲームランチャー内から直接メンテナンスできるようにし、
キー重複や JSON タイポといった手作業ミスを減らす。GUI で視覚的にブロックを確認・編集し、
確定した内容をその場でコピー／ダウンロードできることを目指す。

## ツール概要
- 配置場所: 選択画面「ツールズ」タブ内、サイドメニューの「BlockData編集」
- レイアウト: 左に対象セット切り替え＋検索、右に編集フォームと JSON プレビュー
- 対象データ: `version`、`blocks1` / `blocks2` / `blocks3` の各配列
- 読み込み方法:
  - 既定では `blockdata.json` をフェッチして初期表示
  - 読み込みに失敗した場合は空のデータとして開始し、利用者にインポートを促す

## 主要コンポーネント
### 1. セット切り替え＆検索（サイドバー）
- 「1st」「2nd」「3rd」ボタンで対象配列を切り替え。件数バッジでレコード数を表示。
- 検索ボックスで `key` / `name` を部分一致フィルター。
- 「+ 新規ブロック」ボタンで現在の配列に空のエントリを作成。
- リストは `key` と `Lv` を併記。選択中はハイライト。

### 2. ファイル情報＆アクションバー
- `version` の数値入力欄。
- 操作ボタン: 「再読込」「インポート」「コピー」「ダウンロード」。
  - 再読込: `blockdata.json` を再フェッチ（未保存変更がある場合は確認ダイアログ）。
  - インポート: JSON ファイルを選択し、構造を検証した上で読み込み。
  - コピー: 右側の JSON プレビューをクリップボードへ。
  - ダウンロード: 現在のデータを `blockdata.json` として保存。
- ステータス表示: 未保存変更の有無と最新のフィードバックメッセージを表示。

### 3. ブロック編集フォーム
- 入力フィールド: `key`、`name`、`level`、`size`、`depth`、`chest`、`type`、`bossFloors`。
  - `chest` はプルダウン（`normal` / `more` / `less`）。
  - `type` はテキスト入力＋ datalist による候補補完。
  - `bossFloors` はカンマ区切りの整数を入力。
- 「追加プロパティ(JSON)」欄で標準フィールド以外の任意プロパティを JSON オブジェクトとして入力。
- 保存ボタン: 新規／編集中の内容を現在の配列に反映し、未保存フラグを立てる。
- 削除ボタン: 選択中のブロックを配列から除去（確認ダイアログあり）。
- 編集中に別のブロックへ切り替える／セットを変更する際は、変更破棄の確認ダイアログを表示。

### 4. JSON プレビュー
- ツール全体のデータを 2 スペース整形で表示。
- 行数と推定バイト数のメタ情報をヘッダーに表示。
- フォームで保存するたびに自動更新し、コピー／ダウンロードのソースとなる。

## バリデーションと整形
- `key` と `name` は必須。`key` はセット内で一意。
- `level` / `size` / `depth` は整数に正規化（四捨五入）。
- `bossFloors` は整数のみ受け付け、無効なトークンがあれば保存不可とする。
- 追加プロパティ欄は JSON オブジェクトのみ受け付け。配列やプリミティブはエラー。
- インポート時も同じ整形・検証を通して内部表現に変換。

## 操作フロー例
1. ツールズタブ → BlockData編集を開く。
2. `blockdata.json` が読み込まれ、1st 配列の一覧が表示される。
3. 検索またはリストからブロックを選択し、右側フォームで値を編集。
4. 「選択を保存」で反映。未保存フラグが立つので、必要に応じて「コピー」または「ダウンロード」で永続化。
5. 新規追加は「+ 新規ブロック」から。不要になったエントリは「削除」。
6. 別環境からのデータを反映したい場合は「インポート」で JSON ファイルを読み込み。

## 今後の拡張案
- リストの並べ替え（Lv 昇順／キー順）のトグル。
- 複数ブロックの一括編集・インポート（CSV → JSON 変換）支援。
- 変更履歴の仮想スタック化（元に戻す／やり直す）。
- `bossFloors` 入力をタグ UI 化し、整数チップで視覚的に編集。
