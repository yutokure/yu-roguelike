# マインスイーパーミニゲームの設計

本設計は「ミニゲームAPI書（MiniExp MOD API v0.1）」に準拠します。`create(root, awardXp, { difficulty })` から実行し、EXPは常に `awardXp(n)` 経由で付与します。

- ID: `minesweeper`
- 表示名: マインスイーパー
- エントリ: `games/minesweeper.js`
- バージョン: 0.1.0
- 概要: クリックでセルを開き、地雷を避けて全マスを開放するゲーム。開いた枚数と面クリアでEXP獲得。

## ルール/操作
- 左クリック: セルを開く（0 の連結はフラッド展開）。
- 右クリック/長押し: フラグ設置/解除（EXPなし、補助機能）。
- クリア条件: 地雷以外の全セルを開く。
- 失敗: 地雷を開いた時点で終了（EXPは保持）。

## 難易度と盤面
- EASY: 9x9, 地雷 10
- NORMAL: 16x16, 地雷 40
- HARD: 30x16, 地雷 99（横長）。
- キャンバスは `root.clientWidth` にスケール。セルは可変ピクセル（最小 16px）。

## EXP 仕様（必須要件の反映）
- セルオープン時: 1回の操作で新たに開いたセル枚数 × 0.1 を即時付与（難易度共通）。
- 面クリア時: EASY=25 / NORMAL=200 / HARD=1600 を一度に付与。
- 端数処理: 小数のまま `awardXp`。表示はホスト側で整数丸め。

## 記録/スコア
- `getScore()`:
  - クリア時: `score = floor(1_000_000 / clearTimeMs)`（速いほど高スコア）。
  - 失敗時: `score = openedSafeCells`（開いた安全セル数）。
- ホストの `bestScore` は最大値更新。

## UI/表示
- 上部に残り地雷数/タイムを表示。
- `#miniexp-hud` へ「+N EXP」バッジを都度表示（大量展開時は 200ms 合算推奨）。
- ズーム/リサイズは `ResizeObserver` で追従。

## 実装方針（API連携）
- `create(root, awardXp, { difficulty })`:
  - 盤面生成（難易度でサイズ/地雷数を決定）。初クリック安全配置。
  - 入力: `pointerdown` で左/右を判定。モバイルは長押しでフラグ。
  - セル展開の結果 `newOpenedCount > 0` なら `awardXp(newOpenedCount * 0.1, { type:'open' })`。
  - クリア時に `awardXp(bonusByDifficulty, { type:'clear' })`。
- `start/stop/destroy`: タイマー/イベント/DOMの管理を厳守。

## エラー/ガード
- 盤面外アクセスの防止、複数回 `destroy()` の冪等性確保。
- `visibilitychange` で一時停止（タイマー停止）。

## manifest.json 例
```json
{ "id": "minesweeper", "name": "マインスイーパー", "entry": "games/minesweeper.js", "version": "0.1.0", "description": "開放×0.1 / クリアボーナス", "category": "パズル" }
```
