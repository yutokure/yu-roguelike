<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ミニゲーム: 動画プレイヤー</title>
    <link rel="stylesheet" href="../manual.css">
</head>
<body>
    <main>
        <h1>ミニゲーム: 動画プレイヤー</h1>
        <section>
            <h2>概要</h2>
            <p>
                動画プレイヤーは、MiniExp 内でローカル動画ファイルと YouTube 動画の両方を再生できるユーティリティ系ミニゲームです。
                再生準備・操作・完走・経過時間に応じて経験値 (EXP) が付与されるほか、最近視聴したソースを履歴として保持して再呼び出しできます。
            </p>
        </section>
        <section>
            <h2>画面構成</h2>
            <ul>
                <li>
                    <strong>ヘッダーパネル</strong> — 現在のソース種別、タイトル、動画長、再生ステータスを表示し、右上のバッジにセッション中の獲得 EXP 合計を表示します。
                </li>
                <li>
                    <strong>ソース切り替えカード</strong> — 「ローカルファイル」「YouTube URL」のタブを切り替え、ファイル選択・URL 入力・読み込みボタン・補足メッセージをまとめています。下部には処理結果を示すメッセージバナーが表示されます。
                </li>
                <li>
                    <strong>プレイヤー領域</strong> — HTML5 &lt;video&gt; 要素または YouTube IFrame/API プレイヤーを埋め込み、下部に状態テキストを表示します。何も選択していない場合はプレースホルダーが表示されます。
                </li>
                <li>
                    <strong>右サイドカラム</strong> — 最新 5 件の視聴履歴リストとショートカット／ヒント一覧で構成され、履歴のクリアボタンもここにあります。
                </li>
            </ul>
        </section>
        <section>
            <h2>対応ソースと読み込み手順</h2>
            <h3>ローカルファイル</h3>
            <ol>
                <li>「ローカルファイル」タブを選択して <code>video/*</code> を受け付けるファイル選択フォームを開きます。</li>
                <li>MP4・WebM・Ogg などブラウザが再生可能なファイルを選ぶと即座に Object URL が生成され、HTML5 プレイヤーが表示されます。</li>
                <li>メタデータ読み込み後に動画長が情報パネルへ反映され、「ローカル動画を読み込みました」というステータスとメッセージが表示されます。</li>
            </ol>
            <p class="small-note">ファイル選択に失敗した場合は「動画ファイルを選択してください」というエラーメッセージが表示され、読み込みエラー時には再生領域が初期化されます。</p>
            <h3>YouTube</h3>
            <ol>
                <li>「YouTube URL」タブで URL または動画 ID を入力します。<code>youtu.be/</code>、<code>watch?v=</code>、<code>/embed/</code> 形式に対応し、ID 文字列のみでも読み取ります。</li>
                <li>「読み込み」ボタン、または入力欄で Enter キーを押すとプレイヤーが起動し、プレースホルダーのタイトルが表示された状態で読み込みが進みます。</li>
                <li>利用環境で IFrame API が利用可能な場合は YouTube Player API を使ったプレイヤーが生成され、準備完了後に正式タイトルと動画長を取得して表示します。</li>
                <li>API が利用できない／読み込みに失敗した場合は自動的に簡易モード (単純な埋め込み iframe) に切り替わり、その旨のメッセージが表示されます。</li>
            </ol>
            <p class="small-note">無効な URL や ID の場合は「有効な YouTube URL または動画IDを入力してください。」とエラーバナーに表示されます。</p>
        </section>
        <section>
            <h2>再生操作とステータス</h2>
            <ul>
                <li>ローカル動画は HTML5 標準のコントロールに加え、プレイヤーが <kbd>Space</kbd> で再生/一時停止、<kbd>←</kbd>/<kbd>→</kbd> で ±5 秒のシークを受け付けます。</li>
                <li>YouTube API モードでも同じキーボードショートカットが有効です。簡易モードでは YouTube 側ショートカットを利用してください。</li>
                <li>ステータス表示は「再生中」「一時停止」「再生完了」「バッファリング中」などプレイヤーから取得した状態を反映します。YouTube API でエラーが発生すると「YouTube プレイヤーエラー」が表示されます。</li>
                <li>プレイヤー停止またはソース切り替え時には内部状態がリセットされ、プレースホルダー表示に戻ります。</li>
            </ul>
        </section>
        <section>
            <h2>EXP 獲得ルール</h2>
            <table>
                <thead>
                    <tr><th>トリガー</th><th>条件</th><th>EXP</th></tr>
                </thead>
                <tbody>
                    <tr><td>読み込み完了</td><td>ローカル動画をロード</td><td>+5</td></tr>
                    <tr><td>読み込み完了</td><td>YouTube 動画をロード（API/簡易モード共通）</td><td>+3</td></tr>
                    <tr><td>履歴リプレイ</td><td>履歴から再生した場合の追加ボーナス</td><td>+2</td></tr>
                    <tr><td>再生開始</td><td>初回の再生ボタン操作（ソース別に一度だけ）</td><td>+1</td></tr>
                    <tr><td>再生完了</td><td>動画を最後まで再生（ソース別に一度だけ）</td><td>+8</td></tr>
                    <tr><td>視聴進捗</td><td>60 秒ぶん視聴するごと（連続で加算）</td><td>+1</td></tr>
                </tbody>
            </table>
            <p>
                EXP はセッション内でリアルタイムに加算され、上部バッジとホスト側の共通 EXP システムへ反映されます。再生を停止すると内部カウンターがリセットされますが、履歴は保持されます。
            </p>
        </section>
        <section>
            <h2>視聴履歴</h2>
            <ul>
                <li>最新順で最大 20 件までをブラウザの <code>localStorage</code> (<code>mini_video_history_v1</code>) に保存し、画面右側では最新 5 件まで表示します。</li>
                <li>ローカル動画はファイルパスを保存できないため、履歴ボタンを押すと再選択ダイアログが開きます。同じファイルを選ぶと自動的に履歴再生扱いとなり、ボーナス EXP が付与されます。</li>
                <li>YouTube 動画は元の URL が記録され、履歴ボタンで即時に再ロードされます。</li>
                <li>「履歴をクリア」ボタンで保存データを消去し、完了メッセージがバナーに表示されます。</li>
            </ul>
        </section>
        <section>
            <h2>ショートカットとヒント</h2>
            <ul>
                <li><kbd>Space</kbd>：再生 / 一時停止（ローカル動画、および API 利用時の YouTube）</li>
                <li><kbd>←</kbd> / <kbd>→</kbd>：5 秒単位でシーク（同上）</li>
                <li>履歴をクリックして素早く再視聴できます。ローカル動画はファイル再選択が必要です。</li>
                <li>YouTube 簡易モードでは YouTube 側のショートカット（<kbd>K</kbd>/<kbd>J</kbd>/<kbd>L</kbd> など）をご利用ください。</li>
            </ul>
        </section>
        <section>
            <h2>エラーとフォールバック</h2>
            <ul>
                <li>ファイル読み込みエラーや YouTube 読み込みエラーは赤色のメッセージで通知され、ステータスにも反映されます。</li>
                <li>YouTube IFrame API の初期化には 8 秒のタイムアウトが設定されており、読み込めなかった場合は簡易モードへ切り替わります。</li>
                <li>タブ切り替えや停止操作を行うと、各ソースのプレイヤーリソース（Object URL や YouTube Player）が破棄され、不要なメモリ使用やバックグラウンド再生を防ぎます。</li>
            </ul>
        </section>
    </main>
</body>
</html>
