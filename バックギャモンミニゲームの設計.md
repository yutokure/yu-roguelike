# バックギャモンミニゲームの設計

MiniExp MOD API v0.2 準拠でクラシックなバックギャモンを実装する。プレイヤーは人間 vs AI。ダイスロール→合法手の選択→ポイント移動/ベアオフのサイクルを構築し、EXP付与とログ/スコア連携を行う。

- ID: `backgammon`
- 表示名: バックギャモン
- エントリ: `games/backgammon.js`
- バージョン: 0.1.0
- カテゴリ: ボード

## 盤面とルール
- 標準24ポイント。プレイヤーは 23→0（自陣=0〜5）、AIは 0→23（自陣=18〜23）方向へ進む。
- 初期配置: プレイヤー `23:2, 12:5, 7:3, 5:5`、AI `0:2, 11:5, 16:3, 18:5`。
- ヒット: 1枚だけ置かれた敵駒へ入った場合はヒットしバーへ送る。バーからの再入場は相手陣に対応するポイントで行う。
- ベアリングオフ: すべての駒が自陣に集結後、出目に応じてオフ。出目超過は上位ポイントに駒が無い場合のみ許容。
- ダイス: 通常2個。ダブル時は4回分。出目ごとに合法手を再計算し順次消費する。
- ターン: 振れない場合はパス。勝敗は15枚ベアオフ完了で決定。

## UI/操作
- キャンバス描画。上段/下段ポイント＋中央バー/左右ベアオフ領域を可視化。
- 「ダイスを振る」ボタンで手番開始。クリックでポイント選択→合法手ハイライト→遷移先クリック/ベアオフ領域クリックで実行。
- バー上に駒がある場合は自動的にバーを選択（再入場優先）。
- 右側パネルに手番/ダイス履歴/バー枚数/ベアオフ枚数/ヒット数/スコアを表示し、下部ログに手の詳細を追記。
- 再戦ボタンで初期化。Pause/Resumeは API の `stop/start` で管理。

## 難易度差分
- EASY: AI評価値を 0.85 倍（攻撃性・精度ダウン）。
- NORMAL: 既定。
- HARD: AI評価値を 1.15 倍（ヒット/ベアオフ優先度アップ）。

## EXP 仕様
- 通常移動（バー復帰含む）: +1 EXP。
- ヒット: 基本+1 に加え +7（合計8EXP）。
- ベアリングオフ: 基本+1 に加え +6（合計7EXP）。
- 勝利ボーナス: EASY +140 / NORMAL +230 / HARD +360。
- EXP 付与は `awardXp(amount)` を例外ガード付きで呼び出し、ヒット/ベアオフ時はボーナスをまとめて送る。

## 記録/スコア
- `getScore()` = `playerOff * 12 + playerHits * 5 - aiOff * 6`。
- ログは直近10手を UI に表示。`totalPlays`/`bestScore` はホスト側で自動管理。

## 実装メモ
- `ResizeObserver` でキャンバスサイズ自動調整。`ctx.setTransform` で HiDPI 対応。
- 法合法手生成: 出目ごとに盤面を走査し、バー優先/ベアオフ条件をチェック。
- AI: 単手貪欲。ヒット・ベアオフ・バー復帰・出目大を重み付けし評価最大の手を選択。難易度倍率で挙動調整。
- Pause 時は `stop()` で操作無効化。再開時に AI が手番かつ待機状態なら自動でターン処理再開。

## manifest.json 例
```json
{ "id": "backgammon", "name": "バックギャモン", "entry": "games/backgammon.js", "version": "0.1.0", "description": "24ポイントを巡るヒット＆ラン。ベアオフで勝利を掴め", "category": "ボード" }
```
