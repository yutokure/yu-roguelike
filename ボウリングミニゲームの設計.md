# ボウリングミニゲームの設計

本設計は「ミニゲームAPI書（MiniExp MOD API v0.1）」準拠。プレイヤーは方向・曲がり量・投球強さを設定してボールを投げ、NPCボウラーと10フレーム制のスコア勝負を行う。ピンの倒した本数・スペア/ストライクでEXPを付与する。

- ID: `bowling`
- 表示名: ボウリング対決
- エントリ: `games/bowling.js`
- バージョン: 0.1.0

## ルール/操作
- 方向選択フェーズ: 左右キーで初期位置/向きを微調整。UIゲージで左右のエイムを決める。
- 曲がり量フェーズ: A/D または ←/→ でフック量ゲージを停止。左はカーブ大、右はカーブ小。0でストレート。
- パワーフェーズ: Space でパワーバーを止める。強すぎ/弱すぎはピンアクションに影響。
- 投球後は自動進行。ピンの倒れ具合は物理エンジン簡易モデル（擬似計算）で決定。
- 10フレーム制。10フレーム目はスペア/ストライクでボーナス投球を実施。
- NPCは各フレームごとに難易度に応じた確率でストライク/スペア/オープンを決定。

## 難易度
- EASY: NPC平均スコア120前後（ストライク率10%、スペア率30%）。レーン摩擦安定、曲がりゲージ幅広。
- NORMAL: NPC平均スコア160前後（ストライク率25%、スペア率45%）。レーン摩擦中。ゲージ速度標準。
- HARD: NPC平均スコア200前後（ストライク率45%、スペア率40%）。レーン摩擦高（曲がりやすい）。ゲージ速度速。

## EXP 仕様（必須要件の反映）
- ピン1本倒す: +1 EXP。
- スペア達成: 追加で +10 EXP。
- ストライク達成: 追加で +20 EXP。
- ターキー（3連続ストライク）以降の連続ストライク: 各投球で +15 EXP を追加。
- EXP付与タイミング: 投球ごとに倒したピン数分のEXPを集計し、スペア/ストライク判定後に追加分を `awardXp(total,{type:'frame'})` でまとめて付与。連続ストライク時は該当投球で追加呼び出し。

## 記録/スコア
- `getScore()` = プレイヤー合計スコア（10フレームの公式ボウリングスコアリング）。
- ミニゲーム勝敗は最終スコア比較。引き分け時はサドンデス1投勝負（同一なら勝敗なし）。

## UI/演出
- 上部: フレームスコア表（プレイヤー/NPC）。
- 中央: レーンとピン表示、投球軌跡ライン（予想パス）。
- 下部: 3段ゲージ（方向/曲がり/パワー）と現在フェーズ表示、Spaceで確定のガイダンス。
- 投球後、倒れたピンにハイライト。スペア/ストライクで専用演出と `#miniexp-hud` バッジ（variant: `strike`, `spare`, `pins`）。

## 実装方針（API連携）
- `create(root, awardXp, { difficulty })`:
  - レーンモデルとピン配置データを初期化。投球パラメータは3フェーズのUIコンポーネントで設定。
  - 投球結果はベジェ曲線ベースでレーン上の位置をフレームごとに更新し、カーブ量とパワーから倒れるピン数をサンプルベース乱数で決定。
  - 倒したピン/スペア/ストライク/連続ストライクを評価し、EXPを `awardXp` に渡す。
  - NPCは難易度テーブルから結果を先に決定し、アニメーションのみ演出。
- `start/stop/destroy`: 入力リスナーとアニメーションループ管理。

## エラー/ガード
- 10フレーム目のボーナス投球数の整合性チェック。
- NPC結果決定時のスコア計算バグ防止（ストライクでの次投球参照）。
- カーブ/パワー計算の数値範囲を制限してNaN回避。

## manifest.json 例
```json
{ "id": "bowling", "name": "ボウリング対決", "entry": "games/bowling.js", "version": "0.1.0", "description": "方向×曲がり×パワーでNPCと10フレーム勝負", "category": "スポーツ" }
```
