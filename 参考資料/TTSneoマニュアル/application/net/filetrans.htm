<html>

<head>
<meta http-equiv="Content-Language" content="ja">
<meta http-equiv="Content-Type" content="text/html; charset=shift_jis">
<link rel="stylesheet" type="text/css" href="../../style.css">
<title>TCP/IPでファイルの送受信</title>
</head>

<body>

<div id="header">
	<div class="title">
		TCP/IPでファイルの送受信</div>
	<div class="sub">
		TTSneoマニュアル</div>
	<div class="navi">
		<a target="_parent" href="../../index.html">マニュアル</a> &gt; <a target="_parent" href="../index.htm">機能編</a> &gt; <a target="contents" href="menu-net.htm">インターネット</a> &gt;</div>
	<div class="date">
		<!--webbot bot="Timestamp" s-type="EDITED" s-format="%Y/%m/%d" startspan -->2007/03/18<!--webbot bot="Timestamp" endspan i-checksum="12507" -->更新</div>
</div>
<h2>TCP/IP通信をテストする準備</h2>
<blockquote>
	<p>この機能は、LANなどのネットワークでつながったパソコン２台が必要です。<br>
	インターネット経由で通信することも可能ですが、ファイアウォール(NATなど)がある場合は、通信できるようにルータなどの設定を行う必要があります。<br>
	(使用するポートはプログラムで変更可能です) </p>
	<p>ネットワークの設定方法については、インターネットで調べてください。 
	</div>
	</p>
</blockquote>
<p>　</p>
<h2>TCP/IP機能で接続する</h2>
<blockquote>
	<p>ファイル転送を利用するには、「<a href="tcpip.htm">TCP/IPでファイル転送を作る</a>」で紹介した方法と同じように、サーバへ接続します。</p>
</blockquote>
<p>　</p>
<h4>ファイル送受信の方法</h4>
<blockquote>
	<p>ここでは、実際のプログラムを紹介します。<br>
	ファイル送受信の例では、下のような手順でファイルを転送します。</p>
</blockquote>
<table border="1" cellpadding="2" width="100%">
	<tr>
		<td width="50%" align="center" class="items">送信側（クライアントとして接続）</td>
		<td width="50%" align="center" class="items">受信側（サーバとして接続）</td>
	</tr>
	<tr>
		<td width="50%">　</td>
		<td width="50%">サーバとして待機する</td>
	</tr>
	<tr>
		<td width="50%">サーバへ接続する</td>
		<td width="50%">　</td>
	</tr>
	<tr>
		<td width="50%">　</td>
		<td width="50%">接続要求を受け取り、接続を確立する</td>
	</tr>
	<tr>
		<td width="50%">[送信]ボタンが押されると、受信側に、ファイル名を通知する</td>
		<td width="50%">　</td>
	</tr>
	<tr>
		<td width="50%">　</td>
		<td width="50%">送信側から送られたファイル名を受信する</td>
	</tr>
	<tr>
		<td width="50%">　</td>
		<td width="50%">送信側へ&quot;OK&quot;を送信する</td>
	</tr>
	<tr>
		<td width="50%">受信側から送られたOKを受信する</td>
		<td width="50%">　</td>
	</tr>
	<tr>
		<td width="50%">ファイルの内容をバイナリ情報として送信側へ送信する</td>
		<td width="50%">　</td>
	</tr>
	<tr>
		<td width="50%">　</td>
		<td width="50%">バイナリ情報を受け取り、指定したフォルダにファイル名として保存する</td>
	</tr>
	<tr>
		<td width="50%">終了</td>
		<td width="50%">終了</td>
	</tr>
</table>
<p>　</p>
<p><b>受信側（サーバ）の例</b></p>
<blockquote>
	<p>リモートポートとローカルポートを同じ数字に設定しておきます。<br>
	ここでは10番に設定してあります。</p>
	<p>送信側から接続要求があると接続が完了します。<br>
	送信側からファイルが送られると「〜の受信」手順が実行されます。</p>
	<p><font color="#FF0000"><b>注意</b></font><br>
	送られたデータが、テキストであるかバイナリファイルであるかは判断できません。<br>
	下の例のように、事前にバイナリファイルであるかどうかや、ファイル名などを取得する必要があります。</p>
</blockquote>
<p class="example"><span class="rem">ーー// ファイル受信テスト //</span><br>
タイトルは、「ファイル受信」<br>
<br>
「TTSExtra.TCPIP」をファイル転送として利用<br>
<br>
ウィンドウ１の表示<br>
<br>
ファイル転送を初期化<br>
ファイル転送のリモートポートを10へ変える<br>
ファイル転送のローカルポートを10へ変える<br>
<br>
待機<br>
<br>
手順は　ウィンドウ１の表示<br>
ウィンドウ１を使う<br>
’&lt;ウィンドウ１&gt;<br>
ウィンドウ１の中の大きさを282，96へ変えろ<br>
　　その名前を「ファイル受信」へ変えろ<br>
　　その背景を&amp;h8000000Fへ変えろ<br>
テキスト１を作れ<br>
　　その位置と大きさを10，10，240，18へ変えろ<br>
　　その内容を「テスト.bmp」へ変えろ<br>
ボタン２を作れ<br>
　　その位置と大きさを250，10，20，20へ変えろ<br>
　　その名前を「...」へ変えろ<br>
ラベル１を作れ<br>
　　その位置と大きさを20，40，4，12へ変えろ<br>
　　その内容を「」へ変えろ<br>
’ウィンドウ１のメニュー<br>
メニュー　接続を作れ<br>
サブメニュー　「サーバとして待機」を作れ<br>
サブメニュー　「切断」を作れ<br>
サブメニュー　「-」を作れ<br>
サブメニュー　「閉じる」を作れ<br>
’ウィンドウ１のメニュー終わり<br>
’&lt;/ウィンドウ１&gt;<br>
’オブジェクトの詳細設定はこの下に記述してください<br>
<br>
メニューの接続の切断の有効をオフに変えろ<br>
テキスト１の内容を、今の位置に変えろ<br>
ウィンドウ１を表示<br>
<br>
終わり<br>
<br>
手順は　接続の閉じるをクリック<br>
　　閉じる<br>
終わり<br>
<br>
手順は　接続のサーバとして待機をクリック<br>
　　ラベル１の内容を「待機しています　［ファイル転送のローカルホストアドレス］」に変えろ<br>
　　ファイル転送を待機<br>
<br>
　　メニューの接続のサーバとして待機の有効をオフに変えろ<br>
　　メニューの接続の切断の有効をオンに変えろ<br>
終わり<br>
<br>
手順は　接続の切断をクリック<br>
　　ファイル転送を切断<br>
<br>
　　メニューの接続のサーバとして待機の有効をオンに変えろ<br>
　　メニューの接続の切断の有効をオフに変えろ<br>
終わり<br>
<br>
<br>
手順は　ファイル転送の受信<br>
　　もし　フラグは、「受信」　でないなら<br>
<span class="rem">　　　　’１．ファイル名のみを受信した<br>
　　　　’OKを送って、ファイルを送信してもらう</span><br>
　　　　ファイル名は、置換（ファイル転送の内容、改行、「」）<br>
　　　　ラベル１の内容を「［名前だけ（ファイル名）］の受信開始」に変えろ<br>
　　　　テキスト１の内容を、「［今の位置］受信-［名前だけ（ファイル名）］」に変えろ<br>
　　　　ファイル転送の「OK」を送信<br>
　　　　フラグは、「受信」<br>
　　他なら<br>
　　　　<span class="rem">ーー２．送られたファイルを受信して保存</span><br>
　　　　ファイル名は、テキスト１の内容<br>
　　　　ファイル転送のファイル名をファイル受信<br>
　　　　ラベル１の内容を「ファイルを受信しました」に変えろ<br>
　　　　フラグは、「」<br>
　　もし終わり<br>
終わり<br>
手順は　ファイル転送の開始<br>
　　ラベル１の内容を「接続されました　［ファイル転送のリモートホスト］」に変えろ<br>
終わり<br>
手順は　ファイル転送の切断<br>
　　ラベル１の内容を「切断されました」に変えろ<br>
終わり<br>
手順は　ファイル転送のエラー<br>
　　ラベル１の内容を、ファイル転送のエラーメッセージに変えろ<br>
終わり<br>
手順は　ファイル転送の接続要求<br>
　　ラベル１の内容を、「［ファイル転送のリモートホスト］からの接続を受け付けました」に変えろ<br>
終わり<br>
<br>
手順は　ウィンドウ１のボタン２をクリック<br>
　　フォルダを選択<br>
　　もし　選択ウィンドウのキャンセルは、オン　なら　抜ける<br>
　　テキスト１の名前を、選択ウィンドウのフォルダ名に変えろ<br>
終わり</p>
<p>　</p>
<p><b>送信側（クライアント）の例</b></p>
<blockquote>
	<p>バイナリファイルを送信するには、サーバへ接続できた後に「〜をファイル送信」命令を使います。<br>
	下の例では、サーバへファイル名を送り、受け入れ準備が完了したら(「OK」がサーバから送られる)、ファイルを送信するようにしてあります。</p>
</blockquote>
<p class="example"><span class="rem">ーー// ファイルの送信テスト //</span><br>
タイトルは、「ファイルの送信テスト」<br>
<br>
「TTSExtra.TCPIP」をファイル転送として利用<br>
<br>
ウィンドウ１の表示<br>
<br>
ファイル転送を初期化<br>
ファイル転送のリモートポートを10へ変える<br>
ファイル転送のローカルポートを10へ変える<br>
<br>
待機<br>
<br>
手順は　ウィンドウ１の表示<br>
ウィンドウ１を使う<br>
’&lt;ウィンドウ１&gt;<br>
ウィンドウ１の中の大きさを282，96へ変えろ<br>
　　その名前を「ファイル送信」へ変えろ<br>
　　その背景を&amp;h8000000Fへ変えろ<br>
テキスト１を作れ<br>
　　その位置と大きさを10，10，240，18へ変えろ<br>
ボタン１を作れ<br>
　　その位置と大きさを200，40，65，25へ変えろ<br>
　　その名前を「送信」へ変えろ<br>
　　そのエンターを1へ変えろ<br>
ボタン２を作れ<br>
　　その位置と大きさを250，10，20，20へ変えろ<br>
　　その名前を「...」へ変えろ<br>
ラベル１を作れ<br>
　　その位置と大きさを20，50，4，12へ変えろ<br>
　　その内容を「」へ変えろ<br>
’ウィンドウ１のメニュー<br>
メニュー　接続を作れ<br>
サブメニュー　「接続」を作れ<br>
サブメニュー　「切断」を作れ<br>
サブメニュー　「-」を作れ<br>
サブメニュー　「閉じる」を作れ<br>
’ウィンドウ１のメニュー終わり<br>
’&lt;/ウィンドウ１&gt;<br>
’オブジェクトの詳細設定はこの下に記述してください<br>
<br>
メニューの接続の切断の有効をオフに変えろ<br>
<br>
ウィンドウ１を表示<br>
<br>
終わり<br>
<br>
手順は　接続の閉じるをクリック<br>
　　閉じる<br>
終わり<br>
<br>
手順は　接続の接続をクリック<br>
　　接続先は、入力（「接続先を指定してください」，ファイル転送のIPアドレス）<br>
　　もし　接続先は、「」　なら　抜ける<br>
　　ファイル転送を接続先へ接続<br>
<br>
　　メニューの接続の接続の有効をオフに変えろ<br>
　　メニューの接続の切断の有効をオンに変えろ<br>
終わり<br>
<br>
手順は　接続の切断をクリック<br>
　　ファイル転送を切断<br>
<br>
　　メニューの接続の接続の有効をオンに変えろ<br>
　　メニューの接続の切断の有効をオフに変えろ<br>
終わり<br>
<br>
<br>
手順は　ファイル転送の開始<br>
　　ラベル１の内容を「接続されました　［ファイル転送のリモートホスト］」に変えろ<br>
終わり<br>
手順は　ファイル転送の切断<br>
　　ラベル１の内容を「切断されました」に変えろ<br>
終わり<br>
手順は　ファイル転送のエラー<br>
　　ラベル１の内容を、ファイル転送のエラーメッセージに変えろ<br>
終わり<br>
<br>
手順は　ファイル転送の受信<br>
<span class="rem">ーー２．OKを受信したらファイル名を送る</span><br>
　　内容は、ファイル転送の内容<br>
　　もし　探せ（１、内容、「OK」）は、0　でないなら<br>
　　　　ファイル名は、テキスト１の内容<br>
　　　　ラベル１の内容を「［名前だけ（ファイル名）］を送信中しました」に変えろ<br>
　　　　ファイル転送のファイル名をファイル送信<br>
　　　　テキスト１の内容を「」に変えろ<br>
　　もし終わり<br>
終わり<br>
<br>
<br>
手順は　ウィンドウ１のボタン１をクリック<br>
<span class="rem">ーー１．ファイル名のみを送る</span><br>
　　ファイル名は、テキスト１の内容<br>
　　ファイル転送のファイル名を送信<br>
終わり<br>
<br>
手順は　ウィンドウ１のボタン２をクリック<br>
　　<span class="rem">ーー// ファイル名を開く</span><br>
　　選択ウィンドウのタイトルを「ファイルを開く」へ変えろ<br>
　　選択ウィンドウのフィルタを「すべてのファイル|*.*|」へ変えろ<br>
　　開くファイルを選択<br>
　　もし　選択ウィンドウのキャンセルは、オン　なら　抜ける<br>
　　テキスト１の内容を、選択ウィンドウのファイル名に変えろ<br>
終わり</p>

</body>

</html>
